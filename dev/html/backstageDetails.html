<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>管理详情</title>
</head>
<link href="http://zion.meixincn.com/vendor/css/bootstrap.min.css" rel="stylesheet">
<link href="http://zion.meixincn.com/version/dist/css/backstageDetails.min.css" rel="stylesheet">
<body>
<link href="http://zion.meixincn.com/version/dist/css/header.min.css" rel="stylesheet">
<div id="product_head">
    <div class="header">
        <div class="product_logo">
            <img src="http://zion.meixincn.com/version/dist/img/logo.png" alt="">
        </div>
        <ul>
            <li data-name="产品"><a href="/productList.html">产品</a></li>
            <li data-name="订单"><a href="/order.html">订单</a></li>
            <li data-name="客户"><a href="/customerList.html">客户</a></li>
            <li class="backstage" data-name="内部管理"><a href="/backstageList.html">内部管理</a></li>
            <li class="user_img myAccount"><a href="/myAccount.html"></a></li>
            <li class="user_img" id="logout"><a href="javascript:;"><img src="http://zion.meixincn.com/version/dist/img/exit.png" alt=""></a></li>
        </ul>
    </div>
</div>
<div id="main">
    <div id="product_content">
        <div class="product_main">
            <div class="head">
                <p class="head_left"><span style="font-size: 20px;color: #223976;border-left: 3px solid #223967;padding: 0 20px" id="counselor"></span></p>
                <span class="head_right show_permission">登录权限已暂停</span>
            </div>
            <p style="margin-bottom: 20px"><a href="" class="look_indent">查看订单</a></p>
            <div class="counselor_info">

                <div class="row">
                    <div class="col-sm-1"></div>
                    <div class="col-sm-5 line50">
                        <label>电话:</label>&nbsp;&nbsp;&nbsp;
                        <span id="phone"></span>
                    </div>
                    <div class="col-sm-1"></div>
                    <div class="col-sm-5 line50">
                        <label>邮箱:</label>&nbsp;&nbsp;&nbsp;
                        <span id="email"></span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-1"></div>
                    <div class="col-sm-5 line50">
                        <label>订单数量:</label>&nbsp;&nbsp;&nbsp;
                        <span id="number"> <a></a> </span>
                    </div>
                    <div class="col-sm-1"></div>
                    <div class="col-sm-5 line50">
                        <label>总销售金额:</label>&nbsp;&nbsp;&nbsp;
                        <span id="price"> <a></a> </span>
                    </div>
                </div>

            </div>
            <p class="" style="margin:20px 0 20px;"> <a class="change" style="cursor: pointer">修改信息</a></p>
            <p style="margin-bottom: 20px;"> <a class="reset" style="cursor: pointer">重置密码</a></p>
            <p style="margin-bottom: 20px;"> <a class="login_on" style="cursor: pointer">开启登录权限</a></p>
            <!--修改信息模态框-->
            <div class="modal fade bs-example-modal-lg change_info" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title">修改信息</h4>
                        </div>
                        <div class="modal-body">
                            <div class="row" style="margin: 15px">
                                <div class="col-sm-6">
                                    <label for="name" class="col-sm-2 control-label text-left">姓名</label>
                                    <div class="col-sm-9 relative">
                                        <input type="text" style="height: 30px" class="form-control" id="name">
                                        <p class="caution name_caution" style="display: none">请填写投资顾问姓名</p>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="col-sm-1"></div>
                                    <label for="code" class="col-sm-2 control-label text-left">编码</label>
                                    <div class="col-sm-9 relative">
                                        <span style="display: block;height: 30px;line-height: 30px" id="code"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin: 15px">
                                <div class="col-sm-6">
                                    <label for="phone" class="col-sm-2 control-label text-left">电话</label>
                                    <div class="col-sm-9 relative">
                                        <input type="text" style="height: 30px" class="form-control" id="alter_phone">
                                        <p class="caution phone_caution" style="display: none">请填写投资顾问电话</p>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="col-sm-1"></div>
                                    <label for="email" class="col-sm-2 control-label text-left">邮箱</label>
                                    <div class="col-sm-9 relative">
                                        <input type="text" style="height: 30px" class="form-control" id="alter_email">

                                        <p class="caution email_caution" style="display: none">请填写投资顾问邮箱</p>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin: 30px 0 20px 0">
                                <div class="col-sm-6 text-center">
                                    <button type="button" class="btn btn-default" style="width: 100px;height: 34px;outline: none" id="abolish_info">取消</button>
                                </div>
                                <div class="col-sm-6 text-center">
                                    <button type="button" class="btn btn-primary" style="width: 100px;height: 34px;outline: none" id="confirm_info">保存</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--重置密码模态框-->
            <div class="modal fade bs-example-modal-lg reset_password" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title">重置密码</h4>
                        </div>
                        <div class="modal-body">
                            <div class="row" style="margin: 15px">
                                <div class="col-sm-12">
                                    <div class="col-sm-12">
                                        <p class="counselor-name">   </p>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin: 15px">
                                <div class="col-sm-6">
                                    <label for="password" class="col-sm-3 control-label text-left">新密码</label>
                                    <div class="col-sm-8">
                                        <input type="text" style="height: 30px" class="form-control" id="password">
                                        <p class="caution _caution" style="color: red">注：用户首次登陆后将被强制修改密码</p>
                                    </div>
                                </div>
                            </div>
                            <!--<div class="row" style="margin: 15px">-->
                                <!--<div class="col-sm-12">-->
                                    <!--<div class="col-sm-12 send_email">-->
                                        <!--<input type="checkbox"> 把登录信息发至邮箱：chao.zhang@haiyangfinance.com-->
                                    <!--</div>-->
                                <!--</div>-->
                            <!--</div>-->
                            <!--<div class="row" style="margin: 15px">-->
                                <!--<div class="col-sm-12">-->
                                    <!--<div class="col-sm-12 send_phone">-->
                                        <!--<input type="checkbox"> 把登录信息发至电话：13827382838-->
                                    <!--</div>-->
                                <!--</div>-->
                            <!--</div>-->
                            <div class="row" style="margin: 30px 0 20px 0">
                                <div class="col-sm-6 text-center">
                                    <button type="button" class="btn btn-default" style="width: 100px;height: 34px;outline: none" id="abolish_password">取消</button>
                                </div>
                                <div class="col-sm-6 text-center">
                                    <button type="button" class="btn btn-primary" style="width: 100px;height: 34px;outline: none" id="confirm_password">保存</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>
</div>
</body>
<script src="http://zion.meixincn.com/vendor/js/jquery-1.11.1.min.js" type="text/javascript"></script>
<script src="http://zion.meixincn.com/vendor/js/bootstrap.min.js" type="text/javascript"></script>
<script src="http://zion.meixincn.com/vendor/js/jquery.cookie.min.js" type="text/javascript"></script>
<script src="http://zion.meixincn.com/version/dist/js/common.min.js" type="text/javascript"></script>
<script>

    $('#product_head ul li[data-name="内部管理"]').addClass('active');
    
    $(function () {

        $.ajax({
            type: 'get',
            url: base_url + '/zion/channel/amount',
            data: {'code':getUrlParam('code')},
            contentType: "application/json; charset=utf-8",
            headers: {
                "mx_token": $.cookie('mx_token'),
                "mx_secret": $.cookie('mx_secret')
            },
            success: function (res) {
                console.log( res.body )
                if (res.body.amount == null){
                    res.body.amount = 0;
                }
                $('.look_indent').attr('href',encodeURI('/order.html?channel='+ res.body.name))

                $('#counselor').html('投资顾问  '+res.body.name+'   ('+res.body.code+')')
                $('#phone').html(res.body.phone)
                $('#email').html(res.body.email)
                $('#number').html(res.body.count)
                $('#price').html(res.body.amount)
                $('.counselor-name').html(res.body.name+'   ('+res.body.code+')')
                $('#code').html(res.body.code)

                $('#alter_phone').val(res.body.phone)
                $('#alter_email').val(res.body.email)
                $('#name').val(res.body.name)
                $('.change_info').modal('hide')

                if (res.body.is_active){
                    $('.show_permission').html('')
                    $('.login_on').html('关闭登录权限')
                }else {
                    $('.show_permission').html('登录权限已暂停')
                    $('.login_on').html('开启登录权限')
                }
            },
            error: function () {
            }
        })

    })
    
    
    
    //修改模态框
    $('.change').click(function () {
        $('.change_info').modal('show')
    })
    //修改模态框blur验证
    $('#name').blur(function () {
        if ( $('#name').val()!='' ){
            $('#name').parent().removeClass('has-error')
            $('.name_caution').css("display", "none")
        }else {
            $('#name').parent().addClass('has-error')
            $('.name_caution').css("display", "block")
        }
    })
    $('#alter_phone').blur(function () {
        if ( $('#alter_phone').val() > 10 ){
            $('#alter_phone').parent().removeClass('has-error')
            $('.phone_caution').css("display", "none")
        }else {
            $('#alter_phone').parent().addClass('has-error')
            $('.phone_caution').css("display", "block")
        }
    })
    $('#alter_email').blur(function () {
        var reg = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/
        if ( reg.test($('#alter_email').val()) ){
            $('#alter_email').parent().removeClass('has-error')
            $('.email_caution').css("display", "none")
        }else {
            $('#alter_email').parent().addClass('has-error')
            $('.email_caution').css("display", "block")
        }
    })


    //修改模态框确定按钮
    $('#confirm_info').click(function () {
        var data = {};
        data.id = getUrlParam('id');
        data.code = getUrlParam('code');

        if ($('#name').val() == ''){
            $('#name').parent().addClass('has-error')
            $('.name_caution').css("display", "block")
        }else {
            data.name = $('#name').val();
        }
        if ($('#alter_phone').val() == ''){
            $('#alter_phone').parent().addClass('has-error')
            $('.phone_caution').css("display", "block")
        }else {
            data.phone = $('#alter_phone').val();
        }
        if ($('#alter_email').val() == ''){
            $('#alter_email').parent().addClass('has-error')
            $('.email_caution').css("display", "block")
        }else {
            data.email = $('#alter_email').val();
        }

        if ($('#name').val() != ''&& $('#alter_phone').val() != '' && $('#alter_email').val() != ''){

            console.log('1')

            $.ajax({
                type: 'post',
                url: base_url + '/zion/channel/editChannel',
                data: JSON.stringify( data ),
                contentType: "application/json; charset=utf-8",
                headers: {
                    "mx_token": $.cookie('mx_token'),
                    "mx_secret": $.cookie('mx_secret')
                },
                success: function (res) {
                    console.log( res.body )
                    $('.change_info').modal('hide')
                    window.location.reload()
                },
                error: function () {
                    alert('修改失败')
                }
            })
        }


    })
    //修改模态框取消按钮
    $('#abolish_info').click(function () {
        $('.phone_caution').css('display','none')
        $('.email_caution').css('display','none')
        $('.name_caution').css('display','none')
        $('.change_info').modal('hide')
    })







    //重置密码模态框
    $('.reset').click(function () {
        $('.reset_password').modal('show')
    })
    //密码确定按钮
    $('#confirm_password').click(function () {

        if ($('#password').val()!=''){

            var data = {'code':getUrlParam('code'),'password':$('#password').val()}
            console.log(data)
            $.ajax({
                type: 'post',
                url: base_url + '/zion/channel_advisor/reset_password',
                data: data  ,
//                contentType: "application/json; charset=utf-8",
                headers: {
                    "mx_token": $.cookie('mx_token'),
                    "mx_secret": $.cookie('mx_secret')
                },
                success: function (res) {
                    console.log( res.body )
                    $('.reset_password').modal('hide')
                },
                error: function () {
                }
            })

        }else {
            alert('请输入重置的密码！')
        }

    })
    //密码取消按钮
    $('#abolish_password').click(function () {
        $('#password').val('')
        $('.reset_password').modal('hide')
    })

    //登录权限
    $('.login_on').click(function () {

        if ($('.login_on').html() == '关闭登录权限'){
            var data = {'code':getUrlParam('code'),'is_active':false}
            $.ajax({
                type: 'get',
                url: base_url + '/zion/channel/reviseLoginAuthority',
                data: data  ,
                contentType: "application/json; charset=utf-8",
                headers: {
                    "mx_token": $.cookie('mx_token'),
                    "mx_secret": $.cookie('mx_secret')
                },
                success: function (res) {
                    console.log( '1' )
                    $('.show_permission').html('登录权限已暂停')
                    $('.login_on').html('开启登录权限')
                },
                error: function () {
                }
            })
        }else {
            var data = {'code':getUrlParam('code'),'is_active':true}
            $.ajax({
                type: 'get',
                url: base_url + '/zion/channel/reviseLoginAuthority',
                data: data  ,
                contentType: "application/json; charset=utf-8",
                headers: {
                    "mx_token": $.cookie('mx_token'),
                    "mx_secret": $.cookie('mx_secret')
                },
                success: function (res) {
                    console.log( '2' )
                    $('.show_permission').html('')
                    $('.login_on').html('关闭登录权限')
                },
                error: function () {
                }
            })

        }
    })

</script>

</html>