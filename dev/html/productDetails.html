<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>产品详情</title>
</head>
<link href="http://zion.meixincn.com/vendor/css/bootstrap.min.css" rel="stylesheet">
<link href="http://zion.meixincn.com//version/dist/css/productDetails.min.css" rel="stylesheet">
<body>

    <link href="http://zion.meixincn.com/version/dist/css/header.min.css" rel="stylesheet">
<div id="product_head">
    <div class="header">
        <div class="product_logo">
            <img src="http://zion.meixincn.com/version/dist/img/logo.png" alt="">
        </div>
        <ul>
            <li data-name="产品"><a href="/productList.html">产品</a></li>
            <li data-name="订单"><a href="/order.html">订单</a></li>
            <li data-name="客户"><a href="/customerList.html">客户</a></li>
            <li class="backstage" data-name="内部管理"><a href="/backstageList.html">内部管理</a></li>
            <li class="user_img myAccount"><a href="/myAccount.html"></a></li>
            <li class="user_img" id="logout"><a href="javascript:;"><img src="http://zion.meixincn.com/version/dist/img/exit.png" alt=""></a></li>
        </ul>
    </div>
</div>
    <div id="main">
        <div id="product_content">
            <div class="product_main">
                <div class="head">
                    <p class="head_left"><span style="font-size: 20px;color: #223976" id="name_number"> </span>&nbsp;&nbsp;&nbsp;<a href="" class="state" id="state"></a></p>

                    <div class="modal fade" id="share" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title" id="myModalLabel">分享</h4>
                                </div>
                                <div class="modal-body">
                                    <p class="text-center" style="color: #223976">请复制链接或使用手机扫码分享链接至客户</p>
                                    <p style="margin:20px 30px 20px 0"> <input id="sharelink_copy" class="sharelink" type="text" value="" style="width: 420px;height: 33px" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"> <button id="copy" type="button" class="btn btn-primary" style="margin-left: -4px;margin-top: -3px;border-radius: 0 3px 3px 0"  data-clipboard-action="copy" data-clipboard-target="#sharelink_copy">复制链接</button>
                                    <div class="QRcode">
                                        <img id="QRcode" src="" alt="">
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="modal fade" id="placeanorder" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">下单</h4>
                                </div>
                                <div class="modal-body1">
                                    <div class="modal-left">
                                        <div class="user_table">
                                            <table class="haveuser">
                                                <thead>
                                                    <tr>
                                                        <td class="w_110">客户姓名</td>
                                                        <td class="w_178">手机号</td>
                                                    </tr>
                                                </thead>
                                                <tbody class="order_info">

                                                </tbody>
                                            </table>
                                        </div>
                                        <p class="text-center" style="margin: 10px 0 20px;"> <button type="button" class="btn btn-primary choose_user">选择此投资人</button> </p>
                                    </div>
                                    <div class="modal-right">
                                        <div class="new_user" style="margin-top: 60px">
                                            <p class="text-center"><img src="http://zion.meixincn.com/version/dist/img/new_order.png" alt=""></p>
                                            <p class="text-center" style="margin: 20px 0 20px;"> <button type="button" class="btn btn-primary new_user"> <i class="glyphicon glyphicon-plus"></i> 新建投资人</button> </p>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                </div>
                <p style="margin-bottom: 20px"><a class="vieworder" href="">查看订单</a></p>
                <div class="product_explain">
                    <table class="table1 mar0">
                        <tr class="table_th">
                            <td class="color_223976" id="returnRate">8+10%</td>
                            <td class="color_223976" id="investTerm">18个月</td>
                            <td class="color_223976" id="minimumInvestAmount">$10000</td>
                        </tr>
                        <tr class="table_th">
                            <td>预计年化</td>
                            <td>投资期限</td>
                            <td>起投金额</td>
                        </tr>
                    </table>
                    <div class="product_html"></div>

                    <!--<table class="table2">-->
                        <!--<tr>-->
                            <!--<td>项目类型</td>-->
                            <!--<td><p></p></td>-->
                        <!--</tr>-->
                        <!--<tr>-->
                            <!--<td>项目周期</td>-->
                            <!--<td><p></p></td>-->
                        <!--</tr>-->
                        <!--<tr>-->
                            <!--<td>投资期限</td>-->
                            <!--<td><p></p></td>-->
                        <!--</tr>-->
                        <!--<tr>-->
                            <!--<td>预计收益</td>-->
                            <!--<td><p></p></td>-->
                        <!--</tr>-->
                        <!--<tr>-->
                            <!--<td>风控措施</td>-->
                            <!--<td>-->
                                <!--<p></p>-->
                                <!--<p></p>-->
                                <!--<p></p>-->
                                <!--<p></p>-->
                            <!--</td>-->
                        <!--</tr>-->
                        <!--<tr>-->
                            <!--<td>投资亮点</td>-->
                            <!--<td><p></p></td>-->
                        <!--</tr>-->
                        <!--<tr>-->
                            <!--<td>产品介绍文件</td>-->
                            <!--<td id="introduce_document">-->

                            <!--</td>-->
                        <!--</tr>-->
                    <!--</table>-->
                </div>
                <p style="margin: 40px 0 15px;font-size: 18px">本期产品销售信息</p>
                <div class="sell_info">
                    <table class="table3">
                        <tr>
                            <td>加入截止</td>
                            <td id="SaleDay"></td>
                        </tr>
                        <tr>
                            <td>起息日期</td>
                            <td id="closeFundStartInterestDay"></td>
                        </tr>
                        <tr>
                            <td>入金方式</td>
                            <td id="payment_way"></td>
                        </tr>
                        <tr>
                            <td>销售文件</td>
                            <td id="sales_document"></td>
                        </tr>
                        <tr>
                            <td>法律文件</td>
                            <td id="legal_document">

                            </td>
                        </tr>
                        <tr>
                            <td>自助下单</td>
                            <td>
                                <p class="backstage1">投资顾问&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    <select style="height: 28px;margin-top: 5px"  id="select1">
                                        <option value="1"></option>
                                    </select>
                                </p>
                                <p>
                                    <input class="sharelink" style="height: 28px;width: 440px;margin-bottom: 5px" type="text" value="">&nbsp;&nbsp;&nbsp;&nbsp;
                                    <button type="button" class="share btn btn-primary" style="outline:none;">分享链接</button>
                                </p>
                            </td>
                        </tr>
                        <tr>
                            <td>辅助下单</td>
                            <td>
                                <p>
                                    <span class="backstage2">
                                        投资顾问&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                        <select style="height: 28px"  id="select2">
                                            <option value="1"></option>
                                        </select>&nbsp;&nbsp;&nbsp;&nbsp;
                                    </span>
                                    <!--<a class="assist" href=""><button type="button" class="order_btn btn btn-primary" style="outline:none;">下单</button></a>-->
                                    <button type="button" class="order_btn btn btn-primary" style="outline:none;">下单</button>
                                </p>
                            </td>
                        </tr>
                    </table>

                    <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">入金指南</h4>
                                </div>
                                <div class="modal-body">
                                    <p style="color: #223976;font-size: 14px;margin-bottom: 10px">请引导客户以银行电汇的方式汇款至以下账户</p>
                                    <div>
                                        <span class="key">收款人</span>
                                        <span class="price" id="account_name">111111111111</span>
                                    </div>
                                    <div>
                                        <span class="key">收款人地址</span>
                                        <span class="price" id="account_address">111111111111</span>
                                    </div>
                                    <div>
                                        <span class="key">收款银行</span>
                                        <span class="price" id="bank_name">111111111111</span>
                                    </div>
                                    <div>
                                        <span class="key">收款银行地址</span>
                                        <span class="price" id="bank_address">111111111111</span>
                                    </div>
                                    <div>
                                        <span class="key">ABA/Routing #</span>
                                        <span class="price" id="routing_number">111111111111</span>
                                    </div>
                                    <div>
                                        <span class="key">Swift Code</span>
                                        <span class="price" id="swift_code">111111111111</span>
                                    </div>
                                    <div>
                                        <span class="key">账户号</span>
                                        <span class="price" id="account_number">111111111111</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <p class="none" style="margin: 40px 0 15px;font-size: 18px">本期产品视频介绍</p>
                <div class="product_videos none">
                    <div class="videos">

                    </div>
                </div>
                <p style="margin: 40px 0 15px;font-size: 18px">本期产品系列</p>
                <div>
                    <table>
                        <thead>
                            <tr class="thead">
                                <td class="w_270" id="name"></td>
                                <td>预计年化</td>
                                <td>投资期限</td>
                                <td>起息时期</td>
                                <td>开售日期</td>
                                <td>停售日期</td>
                                <td></td>
                            </tr>
                        </thead>
                        <tbody id="series">
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        </tbody>

                    </table>
                </div>
            </div>
        </div>
    </div>

</body>
<script src="http://zion.meixincn.com/vendor/js/jquery-1.11.1.min.js" type="text/javascript"></script>
<script src="http://zion.meixincn.com/vendor/js/bootstrap.min.js" type="text/javascript"></script>
<script src="http://zion.meixincn.com/vendor/js/jquery.cookie.min.js" type="text/javascript"></script>
<script src="http://zion.meixincn.com/version/dist/js/common.min.js" type="text/javascript"></script>
<script src="http://zion.meixincn.com/vendor/js/clipboard.min.js" type="text/javascript"></script>
<script>

//    var base_url = 'http://192.168.1.102:8001';
//    var base_url = 'https://zion-api.meixincn.com';
    $(function () {


        //产品描述接口
        $.ajax({
            type: 'get',
            url: base_url + '/channel/product/description',
            data: {'product_id':getUrlParam('product_id')},
            contentType: "application/json; charset=utf-8",
            headers: {
                "mx_token": $.cookie('mx_token'),
                "mx_secret": $.cookie('mx_secret')
            },
            success: function (res) {
                console.log(res.body)
                $('.product_html').html(res.body)
            },
            error: function () {
            }
        })


        //产品信息接口    //系列产品接口
        $.ajax({
            type: 'get',
            url: base_url + '/channel/product/info',
            data: {'product_id':getUrlParam('product_id')},
            contentType: "application/json; charset=utf-8",
            headers: {
                "mx_token": $.cookie('mx_token'),
                "mx_secret": $.cookie('mx_secret')
            },
            success: function (res) {
                console.log(res.body)
                //头部信息
                var product_name = res.body.name;
                $('.vieworder').attr('href','/order.html?product='+res.body.number)
                $('#name_number').html(res.body.name+' '+res.body.number)
                if (res.body.status == 'FOR_APPOINTMENT'){
                    $('#state').html('预售').addClass('bg_yu')
                }
                if (res.body.status == 'FOR_INVEST'){
                    $('#state').html('在售').addClass('bg_zai')
                }
                if (res.body.status == 'SOLD_OUT'||res.body.status == 'OFFLINE'){
                    $('#state').html('售罄').addClass('bg_qing')
                }


                //表格信息
                $('#returnRate').html(res.body.return_rate+'%')
                $('#investTerm').html(res.body.invest_term+'个月')
                $('#minimumInvestAmount').html('$'+res.body.minimum_invest_amount)
                $('#SaleDay').html('<p>'+res.body.start_sale_day+' —— '+res.body.end_sale_day+'</p>')
                $('#closeFundStartInterestDay').html('<p>'+res.body.close_fund_start_interest_day+'</p>')

                //系列产品
                $('#name').html(res.body.name);

                //系列产品接口
                $.ajax({
                    type: 'get',
                    url: base_url + '/channel/product/list_by_name',
                    data: {'product_name': product_name},
                    contentType: "application/json; charset=utf-8",
                    headers: {
                        "mx_token": $.cookie('mx_token'),
                        "mx_secret": $.cookie('mx_secret')
                    },
                    success: function (res) {
//                        console.log(res.body)
                        var tabhtml = '';
                        $.each(res.body,function (j,jtem) {

                            var statu = '';
                            if (jtem.status == 'OFFLINE'){
                                statu = '<a href="productDetails.html?product_id='+jtem.id+'" class="state bg_qing">售罄</a>'
                            }
                            if (jtem.status == 'SOLD_OUT'){
                                statu = '<a href="productDetails.html?product_id='+jtem.id+'" class="state bg_qing">售罄</a>'
                            }
                            if (jtem.status == 'FOR_INVEST'){
                                statu = '<a href="productDetails.html?product_id='+jtem.id+'" class="state bg_zai">在售</a>'
                            }
                            if (jtem.status == 'FOR_APPOINTMENT'){
                                statu = '<a href="productDetails.html?product_id='+jtem.id+'" class="state bg_yu">预售</a>'
                            }
                            tabhtml +='<tr><td><a href="productDetails.html?product_id='+jtem.id+'" class="color_223976">'+jtem.number+'</a></td>' +
                                '<td>'+jtem.return_rate+'%</td>' +
                                '<td>'+jtem.invest_term+'个月</td>' +
                                '<td>'+jtem.close_fund_start_interest_day+'</td>' +
                                '<td>'+jtem.start_sale_day+'</td>' +
                                '<td>'+jtem.end_sale_day+'</td>' +
                                '<td class="">'+statu+'</td></tr>'
                        })
                        $('#series').html(tabhtml)

                    },
                    error: function () {
                    }
                })

            },
            error: function () {
            }
        })

        //文件文档接口
        $.ajax({
            type: 'get',
            url: base_url + '/channel/product/document',
            data: {'product_id':getUrlParam('product_id')},
            contentType: "application/json; charset=utf-8",
            headers: {
                "mx_token": $.cookie('mx_token'),
                "mx_secret": $.cookie('mx_secret')
            },
            success: function (res) {
                console.log(res.body)
                //法律文件
                var legalhtml = '';
                $.each(res.body.legal_document,function ( i , item ) {
                    legalhtml += '<p><a target="_blank" href="'+item.document_url+'">'+item.document_name+'</a></p>'
                })
                $('#legal_document').html(legalhtml )
                //销售文件
                var saleshtml = '';
                $.each(res.body.sales_document,function ( i , item ) {
                    saleshtml += '<p><a target="_blank" href="'+item.document_url+'">'+item.document_name+'</a></p>'
                })
                $('#sales_document').html(saleshtml )
                //产品介绍文件
//                var introducehtml = '';
//                $.each(res.body.introduce_document,function ( i , item ) {
//                    introducehtml += '<p><a target="_blank" href="'+item.document_url+'">'+item.document_name+'</a></p>'
//                })
//                $('#introduce_document').html(introducehtml )

                //视频文件
                if (res.body.sales_video.length<1){
                    $('.none').css('display','none')
                }else {
                    $('.videos').html( res.body.sales_video[0].document_url )
                }

            },
            error: function () {
            }
        })

        //入金接口
        $.ajax({
            type: 'get',
            url: base_url + '/channel/product/payment',
            data: {'product_id':getUrlParam('product_id')},
            contentType: "application/json; charset=utf-8",
            headers: {
                "mx_token": $.cookie('mx_token'),
                "mx_secret": $.cookie('mx_secret')
            },
            success: function (res) {
//                console.log(res.body)
                var p = $('<p></p>')
                if (res.body.is_ach_enabled){
                    p.append('ACH（仅支持美国银行账户） ；')
                }
                if (res.body.is_receive_bank_enabled){
                    p.append('银行电汇/Wrie 【<span class="payway">入金指南</span>】 ')
                    $('#account_name').html(res.body.receive_bank.account_name)
                    $('#account_address').html(res.body.receive_bank.account_address)
                    $('#bank_name').html(res.body.receive_bank.bank_name)
                    $('#bank_address').html(res.body.receive_bank.bank_address)
                    $('#routing_number').html(res.body.receive_bank.routing_number)
                    $('#swift_code').html(res.body.receive_bank.swift_code)
                    $('#account_number').html(res.body.receive_bank.account_number)
                }
                $('#payment_way').html( p)


            },
            error: function () {
            }
        })

        //投资顾问分享接口    // 二维码生成
        console.log( is_admin )
        if (is_admin){

            $.ajax({
                type: 'get',
                url: base_url + '/zion/channel_advisor/list',
                contentType: "application/json; charset=utf-8",
                headers: {
                    "mx_token": $.cookie('mx_token'),
                    "mx_secret": $.cookie('mx_secret')
                },
                success: function (res) {
//                    console.log(res.body)
                    var selecthtml1 = '';
                    $.each(res.body,function (i,item) {
                        selecthtml1 += '<option value="'+item.code+'">'+item.code+' - '+item.name+'</option>'
                    })
                    $('#select1').html(selecthtml1)
                    $('#select2').html(selecthtml1)
                    $('.sharelink').attr("value","http://zion.meixincn.com/invest.html?product_id="+getUrlParam('product_id')+"&partner_id="+res.body[0].code)
                    $('.order_btn').data('shuju',"http://zion.meixincn.com/auxiliary_order/stepOne.html?product_id="+getUrlParam('product_id')+"&channel_code="+res.body[0].code)

                    $('.order_btn').data('code',res.body[0].code)

//                $('.assist').attr("href","https://invest.meixinglobal.com/invest.html?product_id="+getUrlParam('product_id')+"&partner_id="+res.body[0].code)

                    $.ajax({
                        type: 'get',
                        url: base_url + '/channel/qrcode/create',
                        data: {"content":"http://zion.meixincn.com/invest.html?product_id="+getUrlParam('product_id')+"&partner_id="+res.body[0].code},
                        contentType: "application/json; charset=utf-8",
                        headers: {
                            "mx_token": $.cookie('mx_token'),
                            "mx_secret": $.cookie('mx_secret')
                        },
                        success: function (res) {
                            console.log(res.body)
                            $('#QRcode').attr( 'src',res.body )
                        },
                        error: function () {
                        }
                    })
                },
                error: function () {
                }
            })
        }else {

            $.ajax({
                type: 'get',
                url: base_url + '/zion/channel_advisor/info',
                contentType: "application/json; charset=utf-8",
                headers: {
                    "mx_token": $.cookie('mx_token'),
                    "mx_secret": $.cookie('mx_secret')
                },
                success: function (res) {
                    console.log(res.body)
                    $('.sharelink').attr("value","http://zion.meixincn.com/invest.html?product_id="+getUrlParam('product_id')+"&partner_id="+res.body.code)
                    $('.order_btn').data('shuju',"http://zion.meixincn.com/auxiliary_order/stepOne.html?product_id="+getUrlParam('product_id')+"&channel_code="+res.body.code)

                    $('.order_btn').data('code',res.body.code)

                    $.ajax({
                        type: 'get',
                        url: base_url + '/channel/qrcode/create',
                        data: {"content":"http://zion.meixincn.com/invest.html?product_id="+getUrlParam('product_id')+"&partner_id="+res.body.code},
                        contentType: "application/json; charset=utf-8",
                        headers: {
                            "mx_token": $.cookie('mx_token'),
                            "mx_secret": $.cookie('mx_secret')
                        },
                        success: function (res) {
                            console.log(res.body)
                            $('#QRcode').attr( 'src',res.body )
                        },
                        error: function () {
                        }
                    })


                },
                error: function () {
                }
            })





        }


    })


    window.onload = function () {

        $('#product_head ul li[data-name="产品"]').addClass('active');

        if (!is_admin){
            $('.backstage').hide();
            $('.backstage1').hide();
            $('.backstage2').hide();
        }else {
            $('.backstage').show();
            $('.backstage1').show();
            $('.backstage2').show();
        }

        //辅助下单模态框
        var userData = {}
        var choose_user = '';
        $('.order_btn').click(function () {
            $('#placeanorder').modal('show')
            console.log( $('.order_btn').data('shuju'))

            console.log( $('.order_btn').data('code'))

            $.ajax({
                type: 'get',
                url: base_url + '/zion/assist/customer',
                data: {'code':$('.order_btn').data('code')},
                contentType: "application/json; charset=utf-8",
                headers: {
                    "mx_token": $.cookie('mx_token'),
                    "mx_secret": $.cookie('mx_secret')
                },
                success: function (res) {
                    console.log(res.body)
                    userData = res.body;
                    var userhtml = '';
                    $.each(res.body,function (i,item) {
                        userhtml += '<tr class="choose"> <td class="w_110">'+item.first_name+''+item.last_name+'</td>' +
                            ' <td class="w_178">'+item.phone+'</td> </tr>'
                    })
                    $('.order_info').html(userhtml)
                    $('.user_table').css('overflow-y','scroll')
                },
                error: function () {
                }
            })

        })

        //选择投资人按钮
        $('body').on('click','.choose',function () {
            $(this).addClass('user_active').siblings().removeClass('user_active')
            choose_user = $(this).index()
        })




        //选择投资人按钮
        $('.choose_user').click(function () {
            if (userData[choose_user]){
                window.location.href = $('.order_btn').data('shuju')+'&phone='+userData[choose_user].phone;
            }else{
                alert('请选择投资人')
            }

        })

        //新建投资人按钮
        $('.new_user').click(function () {
            window.location.href = $('.order_btn').data('shuju');
        })

        //分享模态框
        $('.share').click(function () {
            $('#share').modal('show')
        })
        //入金模态框
        $('body').on('click','.payway', function (){
            $('.bs-example-modal-lg').modal('show')
        })
        //分享了链接改变 二维码
        $('#select1').change(function () {
            $('.sharelink').attr("value","https://invest.meixinglobal.com/invest.html?product_id="+getUrlParam('product_id')+"&partner_id="+$('#select1').val())

            $.ajax({
                type: 'get',
                url: base_url + '/channel/qrcode/create',
                data: {"content":"https://invest.meixinglobal.com/invest.html?product_id="+getUrlParam('product_id')+"&partner_id="+$('#select1').val()},
                contentType: "application/json; charset=utf-8",
                headers: {
                    "mx_token": $.cookie('mx_token'),
                    "mx_secret": $.cookie('mx_secret')
                },
                success: function (res) {
                    console.log(res.body)
                    $('#QRcode').attr( 'src',res.body )
                },
                error: function () {
                }
            })

        })
        //辅助下单改变
        $('#select2').change(function () {
//            $('.assist').attr("href","https://invest.meixinglobal.com/invest.html?product_id="+getUrlParam('product_id')+"&partner_id="+$('#select2').val())
            $('.order_btn').data('shuju',"http://zion.meixincn.com/auxiliary_order/stepOne.html?product_id="+getUrlParam('product_id')+"&partner_id="+$('#select2').val())
            $('.order_btn').data('code',$('#select2').val())
        })

        //复制分享链接
        var clipboard = new Clipboard('#copy');
        clipboard.on('success', function(e) {
            console.info('Action:', e.action);
            console.info('Text:', e.text);
            console.info('Trigger:', e.trigger);
            alert("复制成功");
            e.clearSelection();
        });

        clipboard.on('error', function(e) {
            console.error('Action:', e.action);
            console.error('Trigger:', e.trigger);
        });



    }
</script>

</html>