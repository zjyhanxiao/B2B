$(function(){function e(e){$("#country").empty().append("<option value=''>请选择</option>"+e),$("#country").find("option:first").prop("selected","selected")}function a(e){function a(e){$("#city").empty().append("<option value=''>请选择</option>"+e).prop("disabled",!1).val(n.address_cn.city)}function d(e){$("#county").empty().append("<option value=''>请选择</option>"+e).prop("disabled",!1).val(n.address_cn.district)}var n=e.body;if(n&&null!=n&&(i=n,null!=n.id_card_expire_date&&""!=n.id_card_expire_date&&$("#address-effective").val(n.id_card_expire_date),null!=n.id_card_url&&""!=n.id_card_url&&$("#address-proof").siblings("img").attr("src",n.id_card_url),"CN"==n.address_type&&null!=n.address_cn)){if(""!=n.address_cn.region&&null!=n.address_cn.region&&""!=n.address_cn.city&&null!=n.address_cn.city&&""!=n.address_cn.district&&null!=n.address_cn.district){$("#country").val(n.address_cn.region);var o={city:"",country:"中国",region:n.address_cn.region};t(o,a);var r={city:n.address_cn.city,country:"中国",region:n.address_cn.region};t(r,d)}""!=n.address_cn.detail&&null!=n.address_cn.detail&&$("#address-detail").val(n.address_cn.detail),n.address_cn.postal_code&&$("#post-code").val(n.address_cn.postal_code)}}function d(e){alert(e.msg)}function t(e,a){$.ajax({type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(e),async:!1,url:base_url+"/white_label/invest/access_district",success:function(e){var d=e.body,t="";d&&d.length>0&&($.each(d,function(e){t+='<option value="'+d[e].name+'">'+d[e].name+"</option>"}),a(t))}})}function n(e){var a=new FormData($("form")[1]);a.append("file",$("#address-proof")[0].files[0]),$.ajax({url:"https://prod-gl-api.meixincn.com/web/upload/private",dataType:"json",type:"post",data:a,async:!1,cache:!1,contentType:!1,processData:!1,success:function(a,d){1==a.code&&($("#address-false").hide(),$("#address-uploading").hide(),e.siblings("img").attr("src",a.body)),1!=a.code&&alert("上传失败,请重新上传")}})}function o(e){e.value=e.value.replace(/(^|\W)(?=\d\W)/g,"$10").replace(y,g).replace(/(\W)+/g,"$1")}var i={},r=getUrlParam("phone")||"",s=getUrlParam("partner_id")||"",c=getUrlParam("product_id")||"",l=getUrlParam("order_number")||"",p=getUrlParam("access_token")||"",u=$(".fa-upload-pic img").attr("src");$(".prev-one").on("click",function(){window.location="/white_label/base_info.html?product_id="+c+"&phone="+r+"&partner_id="+s+"&order_number="+l+"&access_token="+p}),$(".step-two").on("click",function(){function e(e){""==l?window.location="/white_label/bank_info.html?product_id="+c+"&phone="+r+"&partner_id="+s+"&access_token="+p:window.location="/white_label/bank_info.html?product_id="+c+"&phone="+r+"&partner_id="+s+"&order_number="+l+"&access_token="+p}function a(e){$(".step-two").prop("disabled",!1),alert(e.msg)}i.product_id=c;var d=$(".fa-upload-pic img").attr("src");d==u&&(d=""),$(this).prop("disabled",!0);var t=!0,n=$("#address-effective").val(),o=$("#country").val(),_=$("#city").val(),f=$("#county").val(),y=$("#address-detail").val(),g=$("#post-code").val(),h=/^[1-2][0-9][0-9][0-9]-[0-1]{0,1}[0-9]-[0-3]{0,1}[0-9]$/;if(h.test(n)||($("#address-effective").addClass("red-shadow"),t=!1),""==o&&($("#country").addClass("red-shadow"),t=!1),""==_&&($("#city").addClass("red-shadow"),t=!1),""==f&&($("#county").addClass("red-shadow"),t=!1),""==y&&($("#address-detail").addClass("red-shadow"),t=!1),""==g&&($("#post-code").addClass("red-shadow"),t=!1),""==n&&($("#address-effective").addClass("red-shadow"),t=!1),""==d&&($("#address-false").show(),t=!1),t)i.channel_code=s,i.product_id=c,i.order_number=l,i.phone=r,i.id_card_url=d,i.id_card_expire_date=n,i.address_type="CN",i.address_cn={},i.address_cn.country="中国",i.address_cn.region=o,i.address_cn.city=_,i.address_cn.district=f,i.address_cn.detail=y,i.address_cn.postal_code=g,i.access_token=p,postData({url:base_url+"/zion/white_label/operate_user",data:JSON.stringify(i),contentType:"application/json; charset=utf-8",sucFn:e,failFn:a});else{$(this).prop("disabled",!1);var m=$(".red-shadow").eq(0).offset().top;$("body").scrollTop(m)}return!1});var _={city:"",country:"中国",region:""};t(_,e),$("#country").on("change",function(){function e(e){$("#city").empty().append("<option value=''>请选择</option>"+e).prop("disabled",!1),$("#city").find("option:first").prop("selected","selected")}var a=$(this).val();if(""!=a){var d={city:"",country:"中国",region:a};t(d,e)}}),$("#city").on("change",function(){function e(e){$("#county").empty().append("<option value=''>请选择</option>"+e).prop("disabled",!1),$("#county").find("option:first").prop("selected","selected")}var a=$(this).val();if(""!=a){var d={city:a,country:"中国",region:$("#country").val()};t(d,e)}}),""!=r&&""!=p&&getData({url:base_url+"/zion/white_label/order_user_info",data:{phone:r,access_token:p,channel_code:s,order_number:l},sucFn:a,failFn:d}),$("#address-proof").change(function(){var e=$(this),a=$(this).val().toLowerCase(),d=new RegExp("(.*?).(jpg|jpeg|png|gif|bmp)$");d.test(a)?n(e):($(this).val(""),alert("图片格式不正确，支持图片格式(.jpg|.jpeg|.png|.gif|.bmp)"))}),$(".fa-upload-pic").find("a").click(function(){$(this).siblings("input").trigger("click")}),$("input").on("focus",function(){$(this).removeClass("red-shadow")}),$("select").on("focus",function(){$(this).removeClass("red-shadow")}),$("textarea").on("focus",function(){$(this).removeClass("red-shadow")});var f="yyyy-mm-dd",y=new RegExp(f.replace(/(\w+)\W(\w+)\W(\w+)/,"^\\s*($1)\\W*($2)?\\W*($3)?([0-9]*).*").replace(/m|d|y/g,"\\d")),g="$1/$2/$3$4".replace(/\//g,f.match(/\W/));$(".date_input_style").on("keyup",function(e){e.ctrlKey||e.metaKey||!(32==e.keyCode||e.keyCode>46)||o(e.target)}),$("#fileMapping").click(function(){$(".filePicker input").trigger("click")}),uploader_file("#fileMapping"),$(".uploader-demo").find("img").load(function(){var e=$(".uploader-demo").find("img").width(),a=$(".uploader-demo").find("img").height(),d=$(".file-item").width(),t=$(".file-item").height();e/a<d/t?$(".uploader-demo").find("img").css({width:"auto",height:"100%"}):$(".uploader-demo").find("img").css({width:"100%",height:"auto","margin-top":Math.floor((t-d*a/e)/2)+"px"})})});