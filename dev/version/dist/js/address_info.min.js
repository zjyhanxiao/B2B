var user_data={},phone=getUrlParam("phone")||"",partner_id=getUrlParam("partner_id")||"",product_id=getUrlParam("product_id")||"",order_number=getUrlParam("order_number")||"",access_token=getUrlParam("access_token")||"";""==access_token&&(window.location="/verify_code.html?product_id="+partner_id+"&partner_id="+partner_id),$(function(){function e(e){$("#country").empty().append("<option value=''>请选择</option>"+e),$("#country").find("option:first").prop("selected","selected")}function a(e){function a(e){$("#city").empty().append("<option value=''>请选择</option>"+e).prop("disabled",!1).val(t.address_cn.city)}function r(e){$("#county").empty().append("<option value=''>请选择</option>"+e).prop("disabled",!1).val(t.address_cn.district)}var t=e.body;if(t&&null!=t&&(user_data=t,null!=t.id_card_expire_date&&""!=t.id_card_expire_date&&$("#address-effective").val(t.id_card_expire_date),null!=t.id_card_url&&""!=t.id_card_url&&$("#fileMapping img").attr("src",t.id_card_url),"CN"==t.address_type&&null!=t.address_cn)){if(""!=t.address_cn.region&&null!=t.address_cn.region&&""!=t.address_cn.city&&null!=t.address_cn.city&&""!=t.address_cn.district&&null!=t.address_cn.district){$("#country").val(t.address_cn.region);var n={city:"",country:"中国",region:t.address_cn.region};d(n,a);var o={city:t.address_cn.city,country:"中国",region:t.address_cn.region};d(o,r)}""!=t.address_cn.detail&&null!=t.address_cn.detail&&$("#address-detail").val(t.address_cn.detail),t.address_cn.postal_code&&$("#post-code").val(t.address_cn.postal_code)}}function r(e){alert(e.msg)}function d(e,a){$.ajax({type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(e),async:!1,url:base_url+"/white_label/invest/access_district",success:function(e){var r=e.body,d="";r&&r.length>0&&($.each(r,function(e){d+='<option value="'+r[e].name+'">'+r[e].name+"</option>"}),a(d))}})}function t(e){e.value=e.value.replace(/(^|\W)(?=\d\W)/g,"$10").replace(_,l).replace(/(\W)+/g,"$1")}function n(e){console.log("合法用户")}function o(e){window.location="/verify_code.html?product_id="+partner_id+"&partner_id="+partner_id}getData({url:base_url+"/zion/common/verify_token",data:{phone:phone,access_token:access_token,channel_code:partner_id},async:!1,sucFn:n,failFn:o});var s={city:"",country:"中国",region:""};d(s,e),""!=phone&&""!=access_token&&getData({url:base_url+"/zion/white_label/order_user_info",data:{phone:phone,access_token:access_token,channel_code:partner_id,order_number:order_number},async:!1,sucFn:a,failFn:r});var c=$("#fileMapping img").attr("src");$(".prev-one").on("click",function(){window.location="/invest.html?product_id="+product_id+"&phone="+phone+"&partner_id="+partner_id+"&order_number="+order_number+"&access_token="+access_token}),$(".step-two").on("click",function(){function e(e){""==order_number?window.location="/white_label/bank_info.html?product_id="+product_id+"&phone="+phone+"&partner_id="+partner_id+"&access_token="+access_token:window.location="/white_label/bank_info.html?product_id="+product_id+"&phone="+phone+"&partner_id="+partner_id+"&order_number="+order_number+"&access_token="+access_token}function a(e){$(".step-two").prop("disabled",!1),alert(e.msg)}user_data.product_id=product_id;var r=$("#fileMapping img").attr("src");r==c&&(r=""),$(this).prop("disabled",!0);var d=!0,t=$("#address-effective").val(),n=$("#country").val(),o=$("#city").val(),s=$("#county").val(),i=$("#address-detail").val(),_=$("#post-code").val(),l=/^[1-2][0-9][0-9][0-9]-[0-1]{0,1}[0-9]-[0-3]{0,1}[0-9]$/;if(l.test(t)||($("#address-effective").addClass("red-shadow"),d=!1),""==n&&($("#country").addClass("red-shadow"),d=!1),""==o&&($("#city").addClass("red-shadow"),d=!1),""==s&&($("#county").addClass("red-shadow"),d=!1),""==i&&($("#address-detail").addClass("red-shadow"),d=!1),""==_&&($("#post-code").addClass("red-shadow"),d=!1),""==t&&($("#address-effective").addClass("red-shadow"),d=!1),""==r&&($("#address-false").show(),d=!1),d)user_data.channel_code=partner_id,user_data.product_id=product_id,user_data.order_number=order_number,user_data.phone=phone,user_data.id_card_url=r,user_data.id_card_expire_date=t,user_data.address_type="CN",user_data.address_cn={},user_data.address_cn.country="中国",user_data.address_cn.region=n,user_data.address_cn.city=o,user_data.address_cn.district=s,user_data.address_cn.detail=i,user_data.address_cn.postal_code=_,user_data.access_token=access_token,postData({url:base_url+"/zion/white_label/operate_user",data:JSON.stringify(user_data),contentType:"application/json; charset=utf-8",sucFn:e,failFn:a});else{$(this).prop("disabled",!1);var p=$(".red-shadow").eq(0).offset().top;$("body").scrollTop(p)}return!1}),$("#country").on("change",function(){function e(e){$("#city").empty().append("<option value=''>请选择</option>"+e).prop("disabled",!1),$("#city").find("option:first").prop("selected","selected")}var a=$(this).val();if(""!=a){var r={city:"",country:"中国",region:a};d(r,e)}}),$("#city").on("change",function(){function e(e){$("#county").empty().append("<option value=''>请选择</option>"+e).prop("disabled",!1),$("#county").find("option:first").prop("selected","selected")}var a=$(this).val();if(""!=a){var r={city:a,country:"中国",region:$("#country").val()};d(r,e)}}),$("input").on("focus",function(){$(this).removeClass("red-shadow")}),$("select").on("focus",function(){$(this).removeClass("red-shadow")}),$("textarea").on("focus",function(){$(this).removeClass("red-shadow")});var i="yyyy-mm-dd",_=new RegExp(i.replace(/(\w+)\W(\w+)\W(\w+)/,"^\\s*($1)\\W*($2)?\\W*($3)?([0-9]*).*").replace(/m|d|y/g,"\\d")),l="$1/$2/$3$4".replace(/\//g,i.match(/\W/));$(".date_input_style").on("keyup",function(e){e.ctrlKey||e.metaKey||!(32==e.keyCode||e.keyCode>46)||t(e.target)}),$("#fileMapping").click(function(){$(".filePicker input").trigger("click")}),uploader_file("#fileMapping")});