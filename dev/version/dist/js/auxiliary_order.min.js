$(function(){function e(e){window.location="/auxiliary_order/invest_success.html?order_number="+d}function n(e){var n=e.body;if(n&&null!=n){$(".beforeOpen").hide(),$("#signaturePage").show(),$(".product_name").html(n.product_name),$(".return_rate").html("预计年化收益："+n.return_rate+"%"),$(".invest_term").html("投资期限："+n.invest_term+"个月"),$(".invest_value span").html(n.invest_amount),$(".product_name").html(n.product_name),$(".full_name").html(n.order_user_info.first_name+" "+n.order_user_info.last_name),$(".phone").html(n.order_user_info.phone),$(".email").html(n.order_user_info.email);var t=n.order_user_info.base_info;$(".date_of_birth").html(t.date_of_birth),$(".source_of_capital").html(t.source_of_capital),$(".industry").html(t.industry),$(".occupation").html(t.occupation),$(".passport_number").html(n.order_user_info.passport_number),$(".passport_expire_date").html(n.order_user_info.passport_expire_date);var r=n.order_user_info.address_cn;if($(".line-1").html(r.region+" "+r.city+" "+r.district),$(".line-2").html(r.detail.replace(/\r\n|\r|\n/,", ")),$(".line-3").html(r.postal_code),"US"==n.order_user_info.bank_type){var i=n.order_user_info.bank_us;$(".bank_name").html(i.bank_name),$(".bank_address").html(i.bank_address.replace(/\r\n|\r|\n/,", ")),$(".routing_number").show().html(i.routing_number),$(".swift_code").html(i.swift_code),$(".account_number").html(i.account_number.replace(/^\d+(\d{4})$/,"****************$1"))}else{var o=n.order_user_info.bank_non_us;$(".bank_name").html(o.bank_name),$(".bank_address").html(o.bank_address.replace(/\r\n|\r|\n/,", ")),$(".swift_code").html(o.swift_code),$(".account_number").html(o.account_number.replace(/^\d+(\d{4})$/,"****************$1")),o.have_middle_bank&&($(".middle_bank").show(),$(".middle_bank_name").html(o.middle_bank_name),$(".middle_bank_address").html(o.middle_bank_address),$(".middle_bank_swift_code").html(o.middle_bank_swift_code))}var a="";s=n.order_user_info,$.each(n.product_document,function(e,n){a+=n.need_mapped?'<div class="checkbox"><label><input type="checkbox">我已阅读并接受</label><a data-id="'+n.id+'" class="getPdf">'+n.document_name+"</a></div>":'<div class="checkbox"><label><input type="checkbox">我已阅读并接受</label><a data-url="'+n.document_url+'" class="getPdf">'+n.document_name+"</a></div>"}),$(".document-item").html(a)}}function t(e){$("#document-loading").hide(),$("#document-element-wrapper").html('<iframe id="document-preview-element" src="vendor/pdfjs/web/viewer.html?file='+e+'#page=1"></iframe>'),$("#document-preview-element").width($(window).width()),$("#document-preview-element").height($(window).height()-45),$("#document-preview-element").css("margin-top","40px")}function r(){$("#document-element-wrapper").html(""),$("#document-preview").width("0%")}function i(e){var n=e.body;if(n){if("FOR_INVEST"!==n.status)return window.location="/auxiliary_order/errLink.html",!1;$(".beforeOpen p").html("请输入密码打开“"+n.name+"”产品投资文件")}}function o(e){alert(e.msg)}$("#signature-line").jSignature({width:800,height:200});var a=$("#signature-line").jSignature("getData"),d=getUrlParam("order_number")||"",u=getUrlParam("product_id")||"",s=null;getData({url:base_url+"/white_label/product_info",data:{product_id:u},sucFn:i,failFn:o}),$(".beforeOpen input").focus(function(){$(this).css("border","1px solid #ccc")}),$(".beforeOpen button").on("click",function(){var e=$(".beforeOpen input").val();""!=e?getData({url:base_url+"/zion/assist/openSignature",data:{orderNumber:d,verifyCode:e},sucFn:n,failFn:o}):$(".beforeOpen input").css("border","1px solid red")}),$(".show-user-info a").on("click",function(){$(this).hide(),$(".user-info").show()}),$(".hide-info").on("click",function(){$(".user-info").hide(),$(".show-user-info a").show()}),$("#update_order").on("click",function(){$("#signature-box").css("border","1px solid #ccc"),$(".document-unCheck").remove(),$(this).prop("disabled",!0);var n=$("#signature-line").jSignature("getData"),t=$(".document-item input:checked").length,r=$('.document-item input[type="checkbox"]').length;return r!=t?($(".document-item").append('<div style="color:red" class="document-unCheck">请认真阅读并勾选以上所有文件</div>'),!1):n==a?($("#signature-box").css("border","1px solid red"),$("body").scrollTop($("#signature-box").offset().top),!1):(postData({url:base_url+"/zion/assist/updateSignature",data:JSON.stringify({order_number:d,signature:n}),contentType:"application/json; charset=utf-8",sucFn:e,failFn:o}),!1)}),$(".document-item").on("click",".getPdf",function(){$("#document-preview").width("100%"),$("#document-loading").show();var e=$(this).data("id");if(!e){var n=$(this).data("url");return void t(n)}return s.document_id=e,$.ajax({type:"post",url:base_url+"/channel/doc/preview",contentType:"application/json; charset=utf-8",data:JSON.stringify(s),success:function(e){t(e.body)}}),!1}),$("#document-preview .close-document-preview").click(function(){r()})});