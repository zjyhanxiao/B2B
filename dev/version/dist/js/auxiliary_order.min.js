$(function(){function e(e){window.location="/auxiliary_order/invest_success.html?order_number="+d}function t(e){var t=e.body;if(t&&null!=t){$(".beforeOpen").hide(),$("#signaturePage").show(),$(".product_name").html(t.product_name),$(".return_rate").html("预计年化收益："+t.return_rate+"%"),$(".invest_term").html("投资期限："+t.invest_term+"个月"),$(".invest_value span").html(t.invest_amount),$(".product_name").html(t.product_name),$(".full_name").html(t.order_user_info.first_name+" "+t.order_user_info.last_name),$(".phone").html(t.order_user_info.phone),$(".email").html(t.order_user_info.email);var n=t.order_user_info.base_info;$(".date_of_birth").html(n.date_of_birth),$(".source_of_capital").html(n.source_of_capital),$(".industry").html(n.industry),$(".occupation").html(n.occupation),$(".passport_number").html(t.order_user_info.passport_number),$(".passport_expire_date").html(t.order_user_info.passport_expire_date);var r=t.order_user_info.address_cn;if($(".line-1").html(r.region+" "+r.city+" "+r.district),$(".line-2").html(r.detail.replace(/\r\n|\r|\n/,", ")),$(".line-3").html(r.postal_code),"US"==t.order_user_info.bank_type){var a=t.order_user_info.bank_us;$(".bank_name").html(a.bank_name),$(".bank_address").html(a.bank_address.replace(/\r\n|\r|\n/,", ")),$(".routing_number").show().html(a.routing_number),$(".swift_code").html(a.swift_code),$(".account_number").html(a.account_number.replace(/^\d+(\d{4})$/,"****************$1"))}else{var o=t.order_user_info.bank_non_us;$(".bank_name").html(o.bank_name),$(".bank_address").html(o.bank_address.replace(/\r\n|\r|\n/,", ")),$(".swift_code").html(o.swift_code),$(".account_number").html(o.account_number.replace(/^\d+(\d{4})$/,"****************$1")),o.have_middle_bank&&($(".middle_bank").show(),$(".middle_bank_name").html(o.middle_bank_name),$(".middle_bank_address").html(o.middle_bank_address),$(".middle_bank_swift_code").html(o.middle_bank_swift_code))}var i="";u=t.order_user_info,$.each(t.product_document,function(e,t){i+=t.need_mapped?'<div class="checkbox"><label><input type="checkbox">我已阅读并接受</label><a data-id="'+t.id+'" class="getPdf">'+t.document_name+"</a></div>":'<div class="checkbox"><label><input type="checkbox">我已阅读并接受</label><a data-url="'+t.document_url+'" class="getPdf">'+t.document_name+"</a></div>"}),$(".document-item").html(i),t.payment_method&&("ach"==t.payment_method?($(".payment").html("确认投资后将通过ACH自动从"+a.bank_name+"（"+a.account_number.replace(/^\d+(\d{4})$/,"$1")+"）扣款"),$(".document-item .checkbox").length>0?$(".document-item").append('<div class="checkbox"><label><input type="checkbox">我已阅读并接受</label><a data-url="/vendor/doc/ACH.pdf" class="getPdf">ACH扣款协议</a></div>'):$(".document-item").prepend('<div class="checkbox"><label><input type="checkbox">我已阅读并接受</label><a data-url="/vendor/doc/ACH.pdf" class="getPdf">ACH扣款协议</a></div>')):$(".payment").html("确认投资后将通过银行电汇线下打款"))}}function n(e){$("#document-loading").hide(),$("#document-element-wrapper").html('<iframe id="document-preview-element" src="/vendor/pdfjs/web/viewer.html?file='+e+'#page=1"></iframe>'),$("#document-preview-element").width($(window).width()),$("#document-preview-element").height($(window).height()-45),$("#document-preview-element").css("margin-top","40px")}function r(){$("#document-element-wrapper").html(""),$("#document-preview").width("0%")}function a(e){var t=e.body;if(t){if("FOR_INVEST"!==t.status)return window.location="/auxiliary_order/errLink.html",!1;$(".beforeOpen p").html("请输入密码打开“"+t.name+"”产品投资文件")}}function o(e){alert(e.msg)}$("#signature-line").jSignature({width:800,height:200});var i=$("#signature-line").jSignature("getData"),d=getUrlParam("order_number")||"",c=getUrlParam("product_id")||"",u=null;getData({url:base_url+"/white_label/product_info",data:{product_id:c},sucFn:a,failFn:o}),$(".beforeOpen input").focus(function(){$(this).css("border","1px solid #ccc")}),$(".beforeOpen button").on("click",function(){var e=$(".beforeOpen input").val();""!=e?getData({url:base_url+"/zion/assist/openSignature",data:{orderNumber:d,verifyCode:e},sucFn:t,failFn:o}):$(".beforeOpen input").css("border","1px solid red")}),$(".show-user-info a").on("click",function(){$(this).hide(),$(".user-info").show()}),$(".hide-info").on("click",function(){$(".user-info").hide(),$(".show-user-info a").show()}),$("#update_order").on("click",function(){$("#signature-box").css("border","1px solid #ccc"),$(".document-unCheck").remove(),$(this).prop("disabled",!0);var t=$("#signature-line").jSignature("getData"),n=$(".document-item input:checked").length,r=$('.document-item input[type="checkbox"]').length;return r!=n?($(".document-item").append('<div style="color:red" class="document-unCheck">请认真阅读并勾选以上所有文件</div>'),!1):t==i?($("#signature-box").css("border","1px solid red"),$("body").scrollTop($("#signature-box").offset().top),!1):(postData({url:base_url+"/zion/assist/updateSignature",data:JSON.stringify({order_number:d,signature:t}),contentType:"application/json; charset=utf-8",sucFn:e,failFn:o}),!1)}),$(".document-item").on("click",".getPdf",function(){$("#document-preview").width("100%"),$("#document-loading").show();var e=$(this).data("id");if(!e){var t=$(this).data("url");return void n(t)}return u.document_id=e,$.ajax({type:"post",url:base_url+"/channel/doc/preview",contentType:"application/json; charset=utf-8",data:JSON.stringify(u),success:function(e){n(e.body)}}),!1}),$("#document-preview .close-document-preview").click(function(){r()})});