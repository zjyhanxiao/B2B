var user_data={},phone=getUrlParam("phone")||"",partner_id=getUrlParam("partner_id")||"",product_id=getUrlParam("product_id")||"",order_number=getUrlParam("order_number")||"",access_token=getUrlParam("access_token")||"";""==access_token&&(window.location="/verify_code.html?product_id="+partner_id+"&partner_id="+partner_id),$(function(){function e(e){var a=e.body;if(a&&null!=a&&(user_data=a,$("#last_name").val(a.last_name),$("#first_name").val(a.first_name),""!=a.phone&&a.phone.indexOf("+")&&$("#phone").val(a.phone.split(" ")[1]),$("#email").val(a.email),$("#date-of-birth").val(a.base_info.date_of_birth),$("#source-of-income").val(a.base_info.source_of_capital),$("#industry").val(a.base_info.industry),$("#passport-number").val(a.passport_number),$("#effective").val(a.passport_expire_date),$("#fileMapping img").attr("src",a.passport_url),""!=a.base_info.industry&&null!=a.base_info.industry&&""!=a.base_info.occupation&&null!=a.base_info.occupation)){var o=a.base_info.occupation;$.ajax({type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify({industry:a.base_info.industry}),url:base_url+"/white_label/invest/access_careers",success:function(e){var a=e.body,n="";$.each(a,function(e){n+='<option value="'+a[e].nameCn+'">'+a[e].nameCn+"</option>"}),$("#occupation").empty().append("<option value=''>请选择</option>"+n).val(o).prop("disabled",!1)}})}}function a(e){alert(e.msg)}function o(e){e.value=e.value.replace(/(^|\W)(?=\d\W)/g,"$10").replace(i,p).replace(/(\W)+/g,"$1")}function n(e){console.log("合法用户")}function t(e){window.location="/verify_code.html?product_id="+partner_id+"&partner_id="+partner_id}var r=$("#fileMapping img").attr("src");getData({url:base_url+"/zion/common/verify_token",data:{phone:phone,access_token:access_token,channel_code:partner_id},async:!1,sucFn:n,failFn:t}),""!=phone&&($("#phone-code,#phone").prop("disabled",!0),phone.indexOf(" ")?($("#phone").val(phone.split(" ")[1]),$("#phone-code").val(phone.split(" ")[0])):$("#phone").val(phone)),$(".step-one").on("click",function(){function e(e){var a=e.body;null!=a&&""!=a.order_number&&null!=a.order_number&&void 0!=a.order_number&&(order_number=a.order_number),""==order_number?window.location="/white_label/address_info.html?product_id="+product_id+"&phone="+phone+"&partner_id="+partner_id+"&access_token="+access_token:window.location="/white_label/address_info.html?product_id="+product_id+"&phone="+phone+"&partner_id="+partner_id+"&order_number="+order_number+"&access_token="+access_token}function a(e){$(".step-one").prop("disabled",!1),alert(e.msg)}var o=$("#fileMapping img").attr("src");o==r&&(o=""),$(this).prop("disabled",!0);var n=!0,t=$("#last_name").val(),s=$("#first_name").val();phone=$("#phone-code").val()+" "+$("#phone").val();var d=$("#email").val(),i=$("#date-of-birth").val(),p=$("#source-of-income").val(),c=$("#industry").val(),l=$("#occupation").val(),_=$("#passport-number").val(),u=$("#effective").val(),f=/^[1][0-9][0-9][0-9]-[0-1]{0,1}[0-9]-[0-3]{0,1}[0-9]$/,h=/^[2][0-9][0-9][0-9]-[0-1]{0,1}[0-9]-[0-3]{0,1}[0-9]$/,m=_.split(""),b=m.length;if(""==t&&($("#last_name").addClass("red-shadow"),n=!1),""==s&&($("#first_name").addClass("red-shadow"),n=!1),(""==phone||phone.length<6)&&($("#phone").addClass("red-shadow"),n=!1),""==d&&($("#email").addClass("red-shadow"),n=!1),d.indexOf("@")!=-1&&d.indexOf(".")!=-1||($("#email").addClass("red-shadow"),n=!1),""==i&&(n=!1,$("#date-of-birth").addClass("red-shadow")),f.test(i)||(n=!1,$("#date-of-birth").addClass("red-shadow")),""==p&&(n=!1,$("#source-of-income").addClass("red-shadow")),""==c&&(n=!1,$("#industry").addClass("red-shadow")),""==l&&(n=!1,$("#occupation").addClass("red-shadow")),""==l&&(n=!1,$("#occupation").addClass("red-shadow")),""==_&&(n=!1,$("#passport-number").addClass("red-shadow")),9!=b&&(n=!1,$("#passport-number").addClass("red-shadow")),""==u&&(n=!1,$("#effective").addClass("red-shadow")),""==o&&(n=!1,$("#passport-false").show(),$("body").scrollTop($("#passport-false").eq(0).offset().top)),h.test(u)||$("#effective").addClass("red-shadow"),n)user_data.channel_code=partner_id,user_data.product_id=product_id,user_data.order_number=order_number,user_data.phone=phone,user_data.last_name=t,user_data.first_name=s,user_data.email=d,user_data.investor_type=1,user_data.base_info={},user_data.base_info.date_of_birth=i,user_data.base_info.source_of_capital=p,user_data.base_info.country_of_birth="中国",user_data.base_info.country_of_tax_residency="中国",user_data.base_info.foreign_tax_number="CN N/A",user_data.base_info.nationality="中国",user_data.base_info.industry=c,user_data.base_info.occupation=l,user_data.passport_number=_,user_data.passport_expire_date=u,user_data.passport_url=o,user_data.access_token=access_token,user_data.product_id=product_id,postData({url:base_url+"/zion/white_label/operate_user",data:JSON.stringify(user_data),contentType:"application/json; charset=utf-8",sucFn:e,failFn:a});else{var v=$(".red-shadow").eq(0).offset().top;$("body").scrollTop(v),$(this).prop("disabled",!1)}return!1});var s={industry:""};$.ajax({type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(s),async:!1,url:base_url+"/white_label/invest/access_careers",success:function(e){var a=e.body,o="";$.each(a,function(e){o+='<option value="'+a[e].nameCn+'">'+a[e].nameCn+"</option>"}),$("#industry").empty().append("<option value=''>请选择</option>"+o)}}),$("#industry").on("change",function(){$("#occupation").prop("disabled",!1);var e=$("#industry").val();if(""!=e){var a={industry:e},o=JSON.stringify(a);$.ajax({type:"post",dataType:"json",contentType:"application/json",data:o,url:base_url+"/white_label/invest/access_careers",success:function(e){var a=e.body,o="";$.each(a,function(e){o+='<option value="'+a[e].nameCn+'">'+a[e].nameCn+"</option>"}),$("#occupation").empty().append("<option value=''>请选择</option>"+o)}})}else $("#occupation").empty()}),""!=phone&&""!=access_token&&getData({url:base_url+"/zion/white_label/order_user_info",data:{phone:phone,access_token:access_token,channel_code:partner_id,order_number:order_number},sucFn:e,failFn:a}),$("input").on("focus",function(){$(this).removeClass("red-shadow")}),$("select").on("focus",function(){$(this).removeClass("red-shadow")}),$("textarea").on("focus",function(){$(this).removeClass("red-shadow")});var d="yyyy-mm-dd",i=new RegExp(d.replace(/(\w+)\W(\w+)\W(\w+)/,"^\\s*($1)\\W*($2)?\\W*($3)?([0-9]*).*").replace(/m|d|y/g,"\\d")),p="$1/$2/$3$4".replace(/\//g,d.match(/\W/));$(".date_input_style").on("keyup",function(e){e.ctrlKey||e.metaKey||!(32==e.keyCode||e.keyCode>46)||o(e.target)}),$("#fileMapping").click(function(){$(".filePicker input").trigger("click")}),uploader_file("#fileMapping")});