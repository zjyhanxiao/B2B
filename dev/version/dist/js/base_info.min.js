$(function(){function e(e){var a=e.body;if(a&&null!=a&&(t=a,$("#last_name").val(a.last_name),$("#first_name").val(a.first_name),""!=a.phone&&a.phone.indexOf("+")&&$("#phone").val(a.phone.split(" ")[1]),$("#email").val(a.email),$("#date-of-birth").val(a.base_info.date_of_birth),$("#source-of-income").val(a.base_info.source_of_capital),$("#industry").val(a.base_info.industry),$("#passport-number").val(a.passport_number),$("#effective").val(a.passport_expire_date),$(".fa-upload-pic img").attr("src",a.passport_url),""!=a.base_info.industry&&null!=a.base_info.industry&&""!=a.base_info.occupation&&null!=a.base_info.occupation)){var o=a.base_info.occupation;$.ajax({type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify({industry:a.base_info.industry}),url:base_url+"/white_label/invest/access_careers",success:function(e){var a=e.body,n="";$.each(a,function(e){n+='<option value="'+a[e].nameCn+'">'+a[e].nameCn+"</option>"}),$("#occupation").empty().append("<option value=''>请选择</option>"+n).val(o).prop("disabled",!1)}})}}function a(e){alert(e.msg)}function o(e){var a=new FormData($("form")[0]);a.append("file",$("#passport-proof")[0].files[0]),$.ajax({url:"https://prod-gl-api.meixincn.com/web/upload/private",dataType:"json",type:"post",data:a,async:!1,cache:!1,contentType:!1,processData:!1,success:function(a,o){if(1==a.code){$("#passport-false").hide();var n=a.body;e.siblings("img").attr("src",n)}1!=a.code&&alert("上传失败,请重新上传")}})}function n(e){e.value=e.value.replace(/(^|\W)(?=\d\W)/g,"$10").replace(f,_).replace(/(\W)+/g,"$1")}var t={},s=getUrlParam("phone")||"",i=getUrlParam("partner_id")||"",r=getUrlParam("product_id")||"",d=getUrlParam("order_number")||"",p=getUrlParam("access_token")||"";""!=s&&($("#phone-code,#phone").prop("disabled",!0),s.indexOf(" ")?$("#phone").val(s.split(" ")[1]):$("#phone").val(s));var l=$(".fa-upload-pic img").attr("src");$(".step-one").on("click",function(){function e(e){var a=e.body;null!=a&&""!=a.order_number&&null!=a.order_number&&void 0!=a.order_number&&(d=a.order_number),""==d?window.location="/white_label/address_info.html?product_id="+r+"&phone="+s+"&partner_id="+i+"&access_token="+p:window.location="/white_label/address_info.html?product_id="+r+"&phone="+s+"&partner_id="+i+"&order_number="+d+"&access_token="+p}function a(e){$(".step-one").prop("disabled",!1),alert(e.msg)}var o=$(".fa-upload-pic img").attr("src");o==l&&(o=""),$(this).prop("disabled",!0);var n=!0,c=$("#last_name").val(),u=$("#first_name").val();s=$("#phone-code").val()+" "+$("#phone").val();var f=$("#email").val(),_=$("#date-of-birth").val(),h=$("#source-of-income").val(),m=$("#industry").val(),b=$("#occupation").val(),v=$("#passport-number").val(),y=$("#effective").val(),g=/^[1][0-9][0-9][0-9]-[0-1]{0,1}[0-9]-[0-3]{0,1}[0-9]$/,w=/^[2][0-9][0-9][0-9]-[0-1]{0,1}[0-9]-[0-3]{0,1}[0-9]$/,C=v.split(""),x=C.length;if(""==c&&($("#last_name").addClass("red-shadow"),n=!1),""==u&&($("#first_name").addClass("red-shadow"),n=!1),(""==s||s.length<6)&&($("#phone").addClass("red-shadow"),n=!1),""==f&&($("#email").addClass("red-shadow"),n=!1),f.indexOf("@")!=-1&&f.indexOf(".")!=-1||($("#email").addClass("red-shadow"),n=!1),""==_&&(n=!1,$("#date-of-birth").addClass("red-shadow")),g.test(_)||(n=!1,$("#date-of-birth").addClass("red-shadow")),""==h&&(n=!1,$("#source-of-income").addClass("red-shadow")),""==m&&(n=!1,$("#industry").addClass("red-shadow")),""==b&&(n=!1,$("#occupation").addClass("red-shadow")),""==b&&(n=!1,$("#occupation").addClass("red-shadow")),""==v&&(n=!1,$("#passport-number").addClass("red-shadow")),9!=x&&(n=!1,$("#passport-number").addClass("red-shadow")),""==y&&(n=!1,$("#effective").addClass("red-shadow")),""==o&&(n=!1,$("#passport-false").show(),$("body").scrollTop($("#passport-false").eq(0).offset().top)),w.test(y)||$("#effective").addClass("red-shadow"),n)t.channel_code=i,t.product_id=r,t.order_number=d,t.phone=s,t.last_name=c,t.first_name=u,t.email=f,t.investor_type=1,t.base_info={},t.base_info.date_of_birth=_,t.base_info.source_of_capital=h,t.base_info.country_of_birth="中国",t.base_info.country_of_tax_residency="中国",t.base_info.foreign_tax_number="CN N/A",t.base_info.nationality="中国",t.base_info.industry=m,t.base_info.occupation=b,t.passport_number=v,t.passport_expire_date=y,t.passport_url=o,t.access_token=p,t.product_id=r,postData({url:base_url+"/zion/white_label/operate_user",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",sucFn:e,failFn:a});else{var j=$(".red-shadow").eq(0).offset().top;$("body").scrollTop(j),$(this).prop("disabled",!1)}return!1});var c={industry:""};$.ajax({type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(c),async:!1,url:base_url+"/white_label/invest/access_careers",success:function(e){var a=e.body,o="";$.each(a,function(e){o+='<option value="'+a[e].nameCn+'">'+a[e].nameCn+"</option>"}),$("#industry").empty().append("<option value=''>请选择</option>"+o)}}),$("#industry").on("change",function(){$("#occupation").prop("disabled",!1);var e=$("#industry").val();if(""!=e){var a={industry:e},o=JSON.stringify(a);$.ajax({type:"post",dataType:"json",contentType:"application/json",data:o,url:base_url+"/white_label/invest/access_careers",success:function(e){var a=e.body,o="";$.each(a,function(e){o+='<option value="'+a[e].nameCn+'">'+a[e].nameCn+"</option>"}),$("#occupation").empty().append("<option value=''>请选择</option>"+o)}})}else $("#occupation").empty()}),""!=s&&""!=p&&getData({url:base_url+"/zion/white_label/order_user_info",data:{phone:s,access_token:p,channel_code:i,order_number:d},sucFn:e,failFn:a}),$("#passport-proof").change(function(){$("#passport-false").hide();var e=$(this),a=$(this).val().toLowerCase(),n=new RegExp("(.*?).(jpg|jpeg|png|gif|bmp)$");n.test(a)?o(e):($(this).val(""),alert("图片格式不正确，支持图片格式(.jpg|.jpeg|.png|.gif|.bmp)"))}),$(".fa-upload-pic").find("a").click(function(){$(this).siblings("input").trigger("click")}),$("input").on("focus",function(){$(this).removeClass("red-shadow")}),$("select").on("focus",function(){$(this).removeClass("red-shadow")}),$("textarea").on("focus",function(){$(this).removeClass("red-shadow")});var u="yyyy-mm-dd",f=new RegExp(u.replace(/(\w+)\W(\w+)\W(\w+)/,"^\\s*($1)\\W*($2)?\\W*($3)?([0-9]*).*").replace(/m|d|y/g,"\\d")),_="$1/$2/$3$4".replace(/\//g,u.match(/\W/));$(".date_input_style").on("keyup",function(e){e.ctrlKey||e.metaKey||!(32==e.keyCode||e.keyCode>46)||n(e.target)}),$("#fileMapping").click(function(){$(".filePicker input").trigger("click")}),uploader_file("#fileMapping"),$(".uploader-demo").find("img").load(function(){var e=$(".uploader-demo").find("img").width(),a=$(".uploader-demo").find("img").height(),o=$(".file-item").width(),n=$(".file-item").height();e/a<o/n?$(".uploader-demo").find("img").css({width:"auto",height:"100%"}):$(".uploader-demo").find("img").css({width:"100%",height:"auto","margin-top":Math.floor((n-o*a/e)/2)+"px"})})});