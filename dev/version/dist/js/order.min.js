$(function(){function t(t){getData({url:base_url+"/zion/order/list",data:t,headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},contentType:"application/json; charset=utf-8",sucFn:e,failFn:d})}function e(t){if(t.body&&t.body.length>0){var e=t.body;is_admin?r(e):a(e)}else $(".order-list tbody").html(""),$(".error").html('<div class="text-center"><img src="/vendor/img/wu.png"><p style="margin-top: 10px;">暂无数据</p></div>');$(".search").prop("disabled",!1)}function r(t){$(".order-list tbody").html("");var e="";$.each(t,function(t,r){var a,d=null!=r.advisor_name?r.advisor_name:"",s=null!=r.phone?r.phone:"",i=null!=r.product_number?r.product_number:"",l=null!=r.product_name?r.product_name:"",o=null!=r.invest_amount?r.invest_amount:"",c=null!=r.first_name?r.first_name:"",u=null!=r.last_name?r.last_name:"",h=null!=r.fa_investment_status?r.fa_investment_status:"",m=null!=r.created_at?n(r.created_at):"",_=null!=r.order_number?r.order_number:"";"not_commit"==h&&(a="未签署"),"not_received"==h&&(a="未入金"),"start_audit"!=h&&"received"!=h||(a="审核中"),"audit_failed"==h&&(a="审核失败"),"audit_success"!=h&&"invest_success"!=h||(a="审核成功"),"start_interest"==h&&(a="投资中"),"refunded"!=h&&"closed"!=h||(a="投资结束"),"voided"==h&&(a="已取消"),e+='<tr><td><a href="/orderDetails.html?order_number='+_+'">'+_+'</a></td><td><a href="/productDetails.html?product_id='+r.product_id+'">'+l+"</a></td><td>"+i+'</td><td><a href="/customerDetails.html?phone='+s+'">'+c+" "+u+"</a></td><td>"+s+"</td><td>"+o+"</td><td>"+d+"</td><td>"+r.code+"</td><td>"+a+"</td><td>"+m+"</td></tr>"}),$(".order-list tbody").html(e)}function a(t){$(".order-list tbody").html("");var e="";$.each(t,function(t,r){var a=null!=r.phone?r.phone:"",d=null!=r.product_number?r.product_number:"",n=null!=r.product_name?r.product_name:"",s=null!=r.invest_amount?r.invest_amount:"",i=null!=r.first_name?r.first_name:"",l=null!=r.last_name?r.last_name:"",o=null!=r.fa_investment_status?r.fa_investment_status:"",c=null!=r.created_at?r.created_at:"",u=null!=r.order_number?r.order_number:"";"not_commit"==o&&(o="未签署"),"not_received"==o&&(o="未入金"),"start_audit"==o&&(o="审核中"),"audit_failed"==o&&(o="审核失败"),"audit_success"==o&&(o="审核通过"),"start_interest"==o&&(o="投资中"),"refunded"==o&&(o="投资结束"),"voided"==o&&(o="已取消"),e+='<tr><td><a href="/orderDetails.html?order_number='+u+'">'+u+'</a></td><td><a href="/productDetails.html?product_id='+r.product_id+'">'+n+"</a></td><td>"+d+'</td><td><a href="/customerDetails.html?phone='+a+'">'+i+" "+l+"</a></td><td>"+a+"</td><td>"+s+"</td><td>"+o+"</td><td>"+c+"</td></tr>"}),$(".order-list tbody").html(e)}function d(t){$(".search").prop("disabled",!1),alert(t.msg)}function n(t){return new Date(1e3*parseInt(t)).toLocaleString().replace(/年|月/g,"-").replace(/日/g," ")}if($('#product_head ul li[data-name="订单"]').addClass("active"),is_admin?($(".adviser").html('<label for="adviser">投资顾问</label><input type="text" class="form-control" id="adviser" placeholder="名称／编号">'),$(".order-list thead").html('<th>订单号</th><th style="width: 130px;">产品名称</th><th>产品编号</th><th>客户姓名</th><th style="width: 132px;">客户电话</th><th style="width: 4em;">金额</th><th style="width: 5em;">投资顾问</th><th style="width: 5em;">顾问编号</th><th style="width: 100px;">状态</th><th style="width: 100px;">投资日期</th>')):($(".adviser").html(""),$(".order-list thead").html('<th>订单号</th><th>产品名称</th><th>产品编号</th><th>客户姓名</th><th style="width: 132px;">客户电话</th><th style="width: 5em;">金额</th><th style="width: 100px;">状态</th><th style="width: 100px;">投资日期</th>')),""==window.location.search){$('.checkbox input[type="checkbox"]').each(function(t,e){t<6?$(e).prop("checked",!0):$(e).prop("checked",!1)});var s="not_commit, not_received, received, start_audit, audit_failed, audit_success, invest_success, start_interest",i={status:s};t(i)}else{var i={},l=getUrlParam("user")||"",o=getUrlParam("product")||"",c=getUrlParam("channel")||"";i.user=l,i.product=o,i.channel_advisor_name=c,$("#product").val(o),$("#user").val(l),is_admin&&$("#adviser").val(c);var u="not_commit, not_received, received, start_audit, audit_failed, audit_success, invest_success, start_interest";i.status=u,t(i)}$("#invest-date").dateRangePicker({language:"cn",showShortcuts:!1,separator:" 至 "}),$(".clear-search").on("click",function(){return $("#order-number").val(""),$("#adviser").val(""),$("#user").val(""),$("#product").val(""),$("#invest-date").val(""),$('.checkbox input[type="checkbox"]').each(function(t,e){t<6?$(e).prop("checked",!0):$(e).prop("checked",!1)}),$(".search").click(),!1}),$("#invest-date").focus(function(){$(this).css("border","1px solid #ccc")}),$(".search").on("click",function(){$(".error").html(""),$(this).prop("disabled",!0);var e={},r=[],a=$('.checkbox input[type="checkbox"]:checked');if($.each(a,function(){r.push($(this).data("status"))}),""!=$("#invest-date").val()){var d=$("#invest-date").val(),n=/\d{4}-\d{2}-\d{2}( 至 )\d{4}-\d{2}-\d{2}/;if(!n.test(d))return $("#invest-date").css("border","1px solid red"),$(this).prop("disabled",!1),!1}return e.number=$("#order-number").val()||"",e.product=$("#product").val()||"",e.channel_advisor_name=$("#adviser").val()||"",e.user=$("#user").val()||"",e.begin=$("#invest-date").val().split(" 至 ")[0]||"",e.end=$("#invest-date").val().split(" 至 ")[1]||"",e.status=r.join(", "),t(e),!1})});