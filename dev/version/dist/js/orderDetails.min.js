$(function(){function a(a){var e=a.body;if(e&&null!=e){l=e.product_id,s=e.order_number;var r,n,c=null!=e.created_at?e.created_at:"",i=null!=e.fa_investment_status?e.fa_investment_status:"",u=null!=e.product_name?e.product_name:"",_=null!=e.product_number?e.product_number:"",m=null!=e.first_name?e.first_name:"",v=null!=e.last_name?e.last_name:"",p=null!=e.invest_amount?"$"+e.invest_amount:0,f=null!=e.advisor_name?e.advisor_name:"",b=null!=e.phone?e.phone:"",h=null!=e.advisor_code?e.advisor_code:"",y=null!=e.remain_amount?"$"+e.remain_amount:0,x=null!=e.close_fund_start_interest_day?e.close_fund_start_interest_day:"";"not_commit"==i&&(r='<span style="color: #ff6600">未签署</span>',n='<div class="row"><div class="col-md-12"><p style="color: red; text-align: right"><span style="font-weight: 700;">失败原因：</span>'+d+"</p></div></div>"),"not_received"==i&&(r='<span style="color: #ff6600">未入金</span>'),"start_audit"!=i&&"received"!=i||(r='<span style="color: #ff9933">审核中</span>'),"audit_failed"==i&&(r='<span style="color: #fa2a2a">审核失败</span>',getData({url:base_url+"/zion/order/failedRemark",data:{order_number:s},async:!1,headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},sucFn:t,failFn:o})),"audit_success"!=i&&"invest_success"!=i||(r='<span style="color: #33cc33">审核成功</span>'),"start_interest"==i&&(r='<span style="color: #4faeff">投资中</span>'),"refunded"!=i&&"closed"!=i||(r='<span style="color: #555">投资结束</span>'),"voided"==i&&(r='<span style="color: #fa2a2a">已取消</span>');var k='<div class="row"><div class="col-md-6 about_product_left"><span class="line"></span><span>订单 '+s+"</span><p>投资日期："+c+'</p></div><div class="col-md-6 about_product_right text-right">';if(k+=r+'<a href="javascript:;" class="status_notes"></a></div></div>',"audit_failed"==i&&(k+=n),"not_commit"==i&&(k+='<div class="row"><div class="col-md-12"><p style="text-align: right"><a href="/auxiliary_order/share.html?product_id='+e.product_id+"&channel_code="+e.advisor_code+"&phone="+b+"&verify_code="+e.verify_code+"&order_number="+s+'">查看签署链接</a></p></div></div>'),k+='<div class="row"><div class="col-md-12"><div class="order-product-detail"><div class="col-md-6"><label>产品</label><a href="/productDetails.html?product_id='+l+'">'+u+" "+_+'</a></div><div class="col-md-6">',is_admin&&(k+='<label>投资顾问</label><a href="/backstageDetails.html?id='+e.advisor_id+"&code="+e.advisor_code+'">'+f+" ["+h+"] </a>"),k+='</div><div class="col-md-6"><label>投资人</label><a href="/customerDetails.html?phone='+e.phone+'">'+m+" "+v+'</a></div><div class="col-md-6"><label>投资金额</label><span>'+p+'</div><div class="col-md-6"><label>起息日期</label><span>'+x+"</span></div>","start_audit"!=i&&"audit_failed"!=i&&"audit_success"!=i&&"invest_success"!=i&&"start_interest"!=i&&"received"!=i&&"start_interest"!=i&&"closed"!=i&&"refunded"!=i||(k+='<div class="col-md-6"><label>入金余额<a href="javascript:;" style="margin-left: 10px;" class="status_notes" title="入金余额为收到的多余资金。此金额不算在投资之内并在投资结束时与本金一并返回投资人的银行账户。"></a></label><span>'+y+"</span></div>"),k+="</div></div></div>",$(".about_product").html(k),i&&("not_commit"==i||"not_received"==i)){var g='<div class="row"><div class="col-md-6 about_product_left"><span class="line"></span><span>订单处理</span></div></div><div class="row"><div class="col-md-12">';"not_commit"==i&&(g+=""),is_admin&&(g+='<buttondata-order="'+s+'" data-toggle="modal" data-target="#myModal" class="cancel_order">取消订单</button>'),g+="</div></div>",$(".about_order").html(g)}}}function e(a){var e=a.body;if(e&&null!=e){var t='<div class="row"><div class="col-md-6 about_product_left"><span class="line"></span><span>投资文件</span></div></div><div class="row document_list">';return $.each(e,function(a,e){if(""!=e.document_url){if("ID_CARD"==e.document_name)return t+='<div class="col-md-12"><a href="'+e.document_url+'" target="_blank">身份证</a></div>',!0;if("PASSPORT"==e.document_name)return t+='<div class="col-md-12"><a href="'+e.document_url+'" target="_blank">护照</a></div>',!0;t+='<div class="col-md-12"><a href="'+e.document_url+'" target="_blank">'+e.document_name+"</a></div>"}}),t+="</div>",$(".about_file").html(t),!1}}function t(a){d=a.body}function o(a){alert(a.msg)}$('#product_head ul li[data-name="订单"]').addClass("active");var s=getUrlParam("order_number")||"",l="",d="";getData({url:base_url+"/zion/order/amount",data:{order_number:s},headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},async:!1,sucFn:a,failFn:o}),getData({url:base_url+"/zion/order/document",data:{order_number:s,product_id:l},headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},sucFn:e,failFn:o}),$(".cancel_order").on("click",function(){function a(){window.location.reload()}function e(a){$("#cancel_order").prop("disabled",!1),alert(a.msg)}return!!is_admin&&($("#myModal .modal-body").html('<p style="color: #223976; font-size: 16px;">订单'+s+'</p><p style="color: #ff3300; font-size: 16px;">请输入'+s+'确定您要取消的订单。订单一旦取消不可复原！</p><input type="text" id="cancel-order-number" class="form-control">'),$("#myModal").modal("show"),$("#cancel_order").on("click",function(){return $("#cancel-order-number").css("border","1px solid #ccc"),$(this).prop("disabled",!0),""==$("#cancel-order-number").val()?($("#cancel-order-number").css("border","1px solid red"),$(this).prop("disabled",!1),!1):(getData({url:base_url+"/zion/order/cancel",data:{order_number:$("#cancel-order-number").val()},headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},sucFn:a,failFn:e}),!1)}),void 0)}),$(".about_order").on("click",function(){return is_admin||alert("您没有该权限"),!1})});