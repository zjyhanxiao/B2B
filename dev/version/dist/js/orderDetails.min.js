$(function(){function a(a){var e=a.body;if(e&&null!=e){d=e.product_id,t=e.order_number;var o,i,c,_,u=null!=e.created_at?e.created_at:"",p=null!=e.fa_investment_status?e.fa_investment_status:"",m=null!=e.product_name?e.product_name:"",b=null!=e.product_number?e.product_number:"",v=null!=e.first_name?e.first_name:"",f=null!=e.last_name?e.last_name:"",k=null!=e.invest_amount?"$"+e.invest_amount:0,h=null!=e.advisor_name?e.advisor_name:"",y=null!=e.phone?e.phone:"",g=null!=e.advisor_code?e.advisor_code:"",x=null!=e.remain_amount?"$"+e.remain_amount:0,w=null!=e.close_fund_start_interest_day?e.close_fund_start_interest_day:"",M="";"not_commit"==p&&(o='<span style="color: #ff6600">未签署</span>',i='<div class="row"><div class="col-md-12"><p style="text-align: right"><a href="/auxiliary_order/share.html?product_id='+e.product_id+"&channel_code="+e.advisor_code+"&phone="+y+"&verify_code="+e.verify_code+"&order_number="+t+'">查看签署链接</a></p></div></div>'),"not_received"==p&&(o='<span style="color: #ff6600">未入金</span>',M='<a href="javascript:;" class="status_notes" data-progress="1" data-title="当前投资进度"></a>',_='<div class="row"><div class="col-md-12 text-right"><a href="javascript:;" class="not_received" data-title="入金指南">入金指南</a></div></div>',getData({url:base_url+"/white_label/product/payment_list",data:{product_id:d},async:!1,sucFn:s,failFn:n})),"start_audit"!=p&&"received"!=p||(o='<span style="color: #ff9933">审核中</span>',M='<a href="javascript:;" class="status_notes" data-progress="2"  data-title="当前投资进度"></a>'),"audit_failed"==p&&(o='<span style="color: #fa2a2a">审核失败</span>',M='<a href="javascript:;" class="status_notes" data-failed="true" data-progress="3"  data-title="当前投资进度"></a>',getData({url:base_url+"/zion/order/failedRemark",data:{order_number:t},async:!1,headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},sucFn:l,failFn:n}),c='<div class="row"><div class="col-md-12"><p style="color: red; text-align: right"><span style="font-weight: 700;">失败原因：</span>'+r+"</p></div></div>"),"audit_success"!=p&&"invest_success"!=p||(o='<span style="color: #33cc33">审核成功</span>',M='<a href="javascript:;" class="status_notes" data-progress="3"  data-title="当前投资进度"></a>'),"start_interest"==p&&(o='<span style="color: #4faeff">投资中</span>',M='<a href="javascript:;" class="status_notes" data-progress="4"  data-title="当前投资进度"></a>'),"refunded"!=p&&"closed"!=p||(o='<span style="color: #555">投资结束</span>',M='<a href="javascript:;" class="status_notes" data-progress="5"  data-title="当前投资进度"></a>'),"voided"==p&&(o='<span style="color: #fa2a2a">已取消</span>');var D='<div class="row"><div class="col-md-6 about_product_left"><span class="line"></span><span>订单 '+t+"</span><p>投资日期："+u+'</p></div><div class="col-md-6 about_product_right text-right">';if(D+=o+M+"</div></div>","not_received"==p&&""!=_&&(D+="<div>"+_+"</div>"),"audit_failed"==p&&""!=r&&(D+=c),"not_commit"==p&&(D+=i),D+='<div class="row"><div class="col-md-12"><div class="order-product-detail"><div class="col-md-6"><label>产品</label><a href="/productDetails.html?product_id='+d+'">'+m+" "+b+'</a></div><div class="col-md-6">',is_admin&&(D+='<label>投资顾问</label><a href="/backstageDetails.html?id='+e.advisor_id+"&code="+e.advisor_code+'">'+h+" ["+g+"] </a>"),D+='</div><div class="col-md-6"><label>投资人</label><a href="/customerDetails.html?phone='+e.phone+'">'+v+" "+f+'</a></div><div class="col-md-6"><label>投资金额</label><span>'+k+'</div><div class="col-md-6"><label>起息日期</label><span>'+w+"</span></div>","start_audit"!=p&&"audit_failed"!=p&&"audit_success"!=p&&"invest_success"!=p&&"start_interest"!=p&&"received"!=p&&"start_interest"!=p&&"closed"!=p&&"refunded"!=p||(D+='<div class="col-md-6"><label>入金余额<a href="javascript:;" style="margin-left: 10px;" class="status_notes" title="入金余额为收到的多余资金。此金额不算在投资之内并在投资结束时与本金一并返回投资人的银行账户。"></a></label><span>'+x+"</span></div>"),D+="</div></div></div>",$(".about_product").html(D),p&&("not_commit"==p||"not_received"==p)){var F='<div class="row"><div class="col-md-6 about_product_left"><span class="line"></span><span>订单处理</span></div></div><div class="row"><div class="col-md-12">';"not_commit"==p&&(F+='<a style="display: block; margin-left: 13px; margin-bottom: 10px;" href="/auxiliary_order/stepOne.html?product_id='+d+"&phone="+y+"&order_number="+t+"&channel_code="+g+'">修改订单</a>'),F+='<buttondata-order="'+t+'" data-toggle="modal" data-title="取消订单" data-target="#myModal" class="cancel_order">取消订单</button>',F+="</div></div>",$(".about_order").html(F)}}}function e(a){var e=a.body;if(e&&null!=e){var l='<div class="row"><div class="col-md-6 about_product_left"><span class="line"></span><span>投资文件</span></div></div><div class="row document_list">';return $.each(e,function(a,e){if(""!=e.document_url){if("ID_CARD"==e.document_name)return l+='<div class="col-md-12"><a href="'+e.document_url+'" target="_blank">身份证</a></div>',!0;if("PASSPORT"==e.document_name)return l+='<div class="col-md-12"><a href="'+e.document_url+'" target="_blank">护照</a></div>',!0;l+='<div class="col-md-12"><a href="'+e.document_url+'" target="_blank">'+e.document_name+"</a></div>"}}),l+="</div>",$(".about_file").html(l),!1}}function l(a){r=a.body}function s(a){var e=a.body;e&&null!=e&&(e.is_receive_bank_enabled&&(""!=e.receive_bank.account_name&&null!=e.receive_bank.account_name&&(o+="<p><label>收款人</label><span>"+e.receive_bank.account_name+"</span></p>"),""!=e.receive_bank.account_address&&null!=e.receive_bank.account_address&&(o+="<p><label>收款人地址</label><span>"+e.receive_bank.account_address+"</span></p>"),""!=e.receive_bank.bank_name&&null!=e.receive_bank.bank_name&&(o+="<p><label>收款银行</label><span>"+e.receive_bank.bank_name+"</span></p>"),""!=e.receive_bank.bank_address&&null!=e.receive_bank.bank_address&&(o+="<p><label>收款银行地址</label><span>"+e.receive_bank.bank_address+"</span></p>"),""!=e.receive_bank.routing_number&&null!=e.receive_bank.routing_number&&(o+="<p><label>ABA/Routing #</label><span>"+e.receive_bank.routing_number+"</span></p>"),""!=e.receive_bank.swift_code&&null!=e.receive_bank.swift_code&&(o+="<p><label>Swift Code</label><span>"+e.receive_bank.swift_code+"</span></p>"),""!=e.receive_bank.account_number&&null!=e.receive_bank.account_number&&(o+="<p><label>账户号</label><span>"+e.receive_bank.account_name+"</span></p>"),""!=e.receive_bank.remark&&null!=e.receive_bank.remark&&(o+="<p><label>备注栏请填写</label><span>"+e.receive_bank.remark+"</span></p>")),e.is_middle_bank_enabled&&(o+="<br>",""!=e.middle_bank.bank_name&&null!=e.middle_bank.bank_name&&(o+="<p><label>中间行名称</label><span>"+e.middle_bank.bank_name+"</span></p>"),""!=e.middle_bank.bank_address&&null!=e.middle_bank.bank_address&&(o+="<p><label>中间行地址</label><span>"+e.middle_bank.bank_address+"</span></p>"),""!=e.middle_bank.swift_code&&null!=e.middle_bank.swift_code&&(o+="<p><label>中间行Swift Code</label><span>"+e.middle_bank.swift_code+"</span></p>")))}function n(a){alert(a.msg)}$('#product_head ul li[data-name="订单"]').addClass("active");var t=getUrlParam("order_number")||"",d="",r="",o="";getData({url:base_url+"/zion/order/amount",data:{order_number:t},headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},async:!1,sucFn:a,failFn:n}),getData({url:base_url+"/zion/order/document",data:{order_number:t,product_id:d},headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},sucFn:e,failFn:n}),$(".not_received").on("click",function(){return $("#myModalLabel").html($(this).data("title")),$("#myModal .modal-footer").hide(),$("#myModal .modal-body").html('<div class="gold_guide">'+o+"</div>"),$("#myModal").modal("show"),!1}),$(".status_notes").on("click",function(){$("#myModalLabel").html($(this).data("title")),$("#myModal .modal-footer").hide();var a='<div class="order_progress clearfix"><div class="number"><ul><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li></ul></div><div class="describe"><ul><li><span style="color: #ff0000">未入金</span><p>认购成功！请客户从Bank of American（5548）账户操作入金</p></li><li><span style="color: #ff6600">审核中</span><p>资金已经进入账户，开始对投资资料进行审核</p></li>';a+=$(this).data("failed")?'<li><span style="color: #f00">审核失败</span><p>审核失败，请按照提示解决订单问题。订单审核通过后才可以进入投资状态。</p></li>':'<li><span style="color: #16bd16">审核通过</span><p>审核通过，等待投资起息</p></li>',a+='<li><span style="color: #4faeff">投资中</span><p>投资开始计息</p></li><li><span style="color: #555">投资结束</span><p>投资结束，本金及利息将全部归还之客户的Bank of American（5548）账户</p></li></ul></div></div>';var e=$(this).data("progress");return $("#myModal .modal-body").html(a),$.each($(".number li"),function(a,l){a<e-1&&$(l).addClass("passing"),a==e-1&&$(l).addClass("active")}),$("#myModal").modal("show"),!1}),$(".cancel_order").on("click",function(){function a(){window.location.reload()}function e(a){$("#cancel_order").prop("disabled",!1),alert(a.msg)}return $("#myModalLabel").html($(this).data("title")),$("#myModal .modal-body").html('<p style="color: #223976; font-size: 16px;">订单'+t+'</p><p style="color: #ff3300; font-size: 16px;">请输入'+t+'确定您要取消的订单。订单一旦取消不可复原！</p><input type="text" id="cancel-order-number" class="form-control">'),$("#myModal .modal-footer").show(),$("#myModal").modal("show"),$("#cancel_order").on("click",function(){return $("#cancel-order-number").css("border","1px solid #ccc"),$(this).prop("disabled",!0),""==$("#cancel-order-number").val()?($("#cancel-order-number").css("border","1px solid red"),$(this).prop("disabled",!1),!1):(getData({url:base_url+"/zion/order/cancel",data:{order_number:$("#cancel-order-number").val()},headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},sucFn:a,failFn:e}),!1)}),!1})});