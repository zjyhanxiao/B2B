$(function(){function e(e){var n=e.body;n&&(p=n.is_ach_enabled)}function n(e){window.location="/auxiliary_order/invest_success.html?order_number="+u}function t(e){var n=e.body;if(n&&null!=n){$("#signaturePage").show(),$(".product_name").html(n.product_name),$(".return_rate").html("预计年化收益："+n.return_rate+"%"),$(".invest_term").html("投资期限："+n.invest_term+"个月"),$(".invest_value span").html(n.invest_amount),$(".product_name").html(n.product_name),$(".full_name").html(n.order_user_info.first_name+" "+n.order_user_info.last_name),$(".phone").html(n.order_user_info.phone),$(".email").html(n.order_user_info.email);var t=n.order_user_info.base_info;$(".date_of_birth").html(t.date_of_birth),$(".source_of_capital").html(t.source_of_capital),$(".industry").html(t.industry),$(".occupation").html(t.occupation),$(".passport_number").html(n.order_user_info.passport_number),$(".passport_expire_date").html(n.order_user_info.passport_expire_date);var a=n.order_user_info.address_cn;if($(".line-1").html(a.region+" "+a.city+" "+a.district),$(".line-2").html(a.detail.replace(/\r\n|\r|\n/,", ")),$(".line-3").html(a.postal_code),"US"==n.order_user_info.bank_type){p?$("#invest_value .payment").html('<p style="color: #000;margin-bottom: 5px;">入金方式只能选择其中一项：</p><div class="radio"><label><input type="radio" name="optionsRadios" checked value="ach">通过ACH自动从'+n.order_user_info.bank_us.bank_name+"（"+n.order_user_info.bank_us.account_number.replace(/^\d+(\d{4})$/,"$1")+'）扣款</label></div><div class="radio"><label><input type="radio" name="optionsRadios" value="wire">通过银行电汇线下打款</label></div>'):$("#invest_value .payment").html('<div class="checkbox"><label><input type="checkbox" checked value="wire" disabled>通过银行电汇线下打款</label></div>');var r=n.order_user_info.bank_us;$(".bank_name").html(r.bank_name),$(".bank_address").html(r.bank_address.replace(/\r\n|\r|\n/,", ")),$(".routing_number").show().html(r.routing_number),$(".swift_code").html(r.swift_code),$(".account_number").html(r.account_number.replace(/^\d+(\d{4})$/,"****************$1"))}else{var i=n.order_user_info.bank_non_us;$(".bank_name").html(i.bank_name),$(".bank_address").html(i.bank_address.replace(/\r\n|\r|\n/,", ")),$(".swift_code").html(i.swift_code),$(".account_number").html(i.account_number.replace(/^\d+(\d{4})$/,"****************$1")),i.have_middle_bank&&($(".middle_bank").show(),$(".middle_bank_name").html(i.middle_bank_name),$(".middle_bank_address").html(i.middle_bank_address),$(".middle_bank_swift_code").html(i.middle_bank_swift_code)),$("#invest_value .payment").html('<div class="checkbox"><label><input type="checkbox" checked value="wire" disabled>通过银行电汇线下打款</label></div>')}var o="";m=n.order_user_info,$.each(n.product_document,function(e,n){o+=n.need_mapped?'<div class="checkbox"><label>我已阅读并接受</label><a data-id="'+n.id+'" class="getPdf">'+n.document_name+"</a></div>":'<div class="checkbox"><label>我已阅读并接受</label><a data-url="'+n.document_url+'" class="getPdf">'+n.document_name+"</a></div>"}),$(".document-item").html(o)}}function a(e){$("#document-loading").hide(),$("#document-element-wrapper").html('<iframe id="document-preview-element" src="/vendor/pdfjs/web/viewer.html?file='+e+'#page=1"></iframe>'),$("#document-preview-element").width($(window).width()),$("#document-preview-element").height($(window).height()-45),$("#document-preview-element").css("margin-top","40px")}function r(){$("#document-element-wrapper").html(""),$("#document-preview").width("0%")}function i(e){var n=e.body;if(n){if("FOR_INVEST"!==n.status)return window.location="/auxiliary_order/errLink.html",!1;$(".beforeOpen p").html("请输入密码打开“"+n.name+"”产品投资文件")}}function o(e){alert(e.msg)}$("#signature-line").jSignature({width:800,height:200});var d=$("#signature-line").jSignature("getData"),l=getUrlParam("phone")||"",s=getUrlParam("partner_id")||"",c=getUrlParam("product_id")||"",u=getUrlParam("order_number")||"",_=getUrlParam("access_token")||"",m=null;getData({url:base_url+"/white_label/product_info",data:{product_id:c},sucFn:i,failFn:o});var p=!1;""!=c&&getData({url:base_url+"/white_label/product/payment_list",data:{product_id:c},async:!1,sucFn:e,failFn:o}),getData({url:base_url+"/zion/common/openSignature",data:{order_number:u,phone:l,channel_code:s,access_token:_},async:!1,sucFn:t,failFn:o}),$(".show-user-info a").on("click",function(){$(this).hide(),$(".user-info").show()}),$(".hide-info").on("click",function(){$(".user-info").hide(),$(".show-user-info a").show()}),$("#update_order").on("click",function(){$("#signature-box").css("border","1px solid #ccc"),$(".document-unCheck").remove(),$(this).prop("disabled",!0);var e=$("#signature-line").jSignature("getData");if(e==d)return $(this).prop("disabled",!1),$("#signature-box").css("border","1px solid red"),$("body").scrollTop($("#signature-box").offset().top),!1;var t={};return t.order_number=u,t.signature=e,t.channel_code=s,t.invest_amount=1e4,t.payment_method="wire",t.phone=l,t.access_token=_,postData({url:base_url+"/zion/common/updateSignature",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",sucFn:n,failFn:o}),!1}),$(".document-item").on("click",".getPdf",function(){$("#document-preview").width("100%"),$("#document-loading").show();var e=$(this).data("id");if(!e){var n=$(this).data("url");return void a(n)}return m.document_id=e,$.ajax({type:"post",url:base_url+"/channel/doc/preview",contentType:"application/json; charset=utf-8",data:JSON.stringify(m),success:function(e){a(e.body)}}),!1}),$("#document-preview .close-document-preview").click(function(){r()})});