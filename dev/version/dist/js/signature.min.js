var phone=getUrlParam("phone")||"",partner_id=getUrlParam("partner_id")||"",product_id=getUrlParam("product_id")||"",order_number=getUrlParam("order_number")||"",access_token=getUrlParam("access_token")||"";""==access_token&&(window.location="/verify_code.html?product_id="+partner_id+"&partner_id="+partner_id),$(function(){function e(e){var t=e.body;t&&(p=t.is_ach_enabled)}function t(e){window.location="/invest_success.html?order_number="+order_number+"&payment_method="+m+"&bank_name="+_+"&account_number="+u+"&product_id="+product_id}function n(e){var t=e.body;if(t&&null!=t){$("#signaturePage").show(),$(".product_name").html(t.product_name),$(".return_rate").html("预计年化收益："+t.return_rate+"%"),$(".invest_term").html("投资期限："+t.invest_term+"个月"),c=t.min_invest_amount,l=t.invest_par_value,$(".invest-amounts").val(c),l<1e4?$(".invest-par-value").html(t.invest_par_value):$(".invest-par-value").html(l/1e4+"万"),$(".product_name").html(t.product_name),$(".full_name").html(t.order_user_info.first_name+" "+t.order_user_info.last_name),$(".phone").html(t.order_user_info.phone),$(".email").html(t.order_user_info.email);var n=t.order_user_info.base_info;$(".date_of_birth").html(n.date_of_birth),$(".source_of_capital").html(n.source_of_capital),$(".industry").html(n.industry),$(".occupation").html(n.occupation),$(".passport_number").html(t.order_user_info.passport_number),$(".passport_expire_date").html(t.order_user_info.passport_expire_date);var a=t.order_user_info.address_cn;if($(".line-1").html(a.region+" "+a.city+" "+a.district),$(".line-2").html(a.detail.replace(/\r\n|\r|\n/,", ")),$(".line-3").html(a.postal_code),"US"==t.order_user_info.bank_type){var r=t.order_user_info.bank_us;_=r.bank_name,$(".bank_name").html(_),$(".bank_address").html(r.bank_address.replace(/\r\n|\r|\n/,", ")),$(".routing_number").show().html(r.routing_number),$(".swift_code").html(r.swift_code),u=r.account_number.replace(/^\d+(\d{4})$/,"$1"),$(".account_number").html("****************"+u)}else{var o=t.order_user_info.bank_non_us;_=o.bank_name,$(".bank_name").html(_),$(".bank_address").html(o.bank_address.replace(/\r\n|\r|\n/,", ")),$(".swift_code").html(o.swift_code),u=o.account_number.replace(/^\d+(\d{4})$/,"$1"),$(".account_number").html("****************"+u),o.have_middle_bank&&($(".middle_bank").show(),$(".middle_bank_name").html(o.middle_bank_name),$(".middle_bank_address").html(o.middle_bank_address),$(".middle_bank_swift_code").html(o.middle_bank_swift_code))}var i="";s=t.order_user_info,$.each(t.product_document,function(e,t){i+=t.need_mapped?'<div class="checkbox"><a data-id="'+t.id+'" class="getPdf">'+t.document_name+"</a></div>":'<div class="checkbox"><a data-url="'+t.document_url+'" class="getPdf">'+t.document_name+"</a></div>"}),$(".document-item").html(i),p&&"US"==t.order_user_info.bank_type?($("#invest_value .payment").html('<p style="color: #223976;margin-bottom: 5px; font-size: 16px; text-align: left;">入金方式</p><div class="radio"><label><input type="radio" name="optionsRadios" checked value="ach">通过ACH自动从'+_+"（"+u+'）扣款</label></div><div class="radio"><label><input type="radio" name="optionsRadios" value="wire">通过银行电汇线下打款</label></div>'),$(".document-item").append('<div class="checkbox ach"><a data-url="/vendor/doc/ACH.pdf" class="getPdf">ACH自动扣款协议</a></div>'),$(".showAch").html("- 我确认"+_+" ("+u+")账户里面有充足的资金并授权美信金融使用ACH从此账户扣款。")):$("#invest_value .payment").html('<div class="checkbox text-center"><span style="display: block; color: #223976; text-align: center; font-size: 16px;">入金方式</span>通过银行电汇线下打款</div>')}}function a(e){$("#document-loading").hide(),$("#document-element-wrapper").html('<iframe id="document-preview-element" src="/vendor/pdfjs/web/viewer.html?file='+e+'#page=1"></iframe>'),$("#document-preview-element").width($(window).width()),$("#document-preview-element").height($(window).height()-45),$("#document-preview-element").css("margin-top","40px")}function r(){$("#document-element-wrapper").html(""),$("#document-preview").width("0%")}function o(e){var t=e.body;if(t){if("FOR_INVEST"!==t.status)return window.location="/auxiliary_order/errLink.html",!1;$(".beforeOpen p").html("请输入密码打开“"+t.name+"”产品投资文件")}}function i(e){alert(e.msg)}$("#signature-line").jSignature({width:800,height:200});var d=$("#signature-line").jSignature("getData"),s=null,c=0,l=0,u="",_="",m="";getData({url:base_url+"/white_label/product_info",data:{product_id:product_id},sucFn:o,failFn:i});var p=!1;""!=product_id&&getData({url:base_url+"/white_label/product/payment_list",data:{product_id:product_id},async:!1,sucFn:e,failFn:i}),getData({url:base_url+"/zion/common/openSignature",data:{order_number:order_number,phone:phone,channel_code:partner_id,access_token:access_token},async:!1,sucFn:n,failFn:i}),$(".prev_three").on("click",function(){window.location="/white_label/bank_info.html?product_id="+product_id+"&phone="+phone+"&partner_id="+partner_id+"&order_number="+order_number+"&access_token="+access_token}),$(".show-user-info").on("click",function(){$(this).hide(),$(".user-info").show()}),$(".hide-info").on("click",function(){$(".user-info").hide(),$(".show-user-info").show()}),$("#update_order").on("click",function(){$("#signature-box,.invest-amounts").css("border","1px solid #ccc"),$(".document-unCheck").remove(),$(this).prop("disabled",!0);var e=parseInt($(".invest-amounts").val())||c;if(m=$('.payment input[type="radio"]:checked').val()||"wire",e<c||(e-c)%l!=0)return $(".invest-amounts").css("border-color","red"),$("body").scrollTop($(".invest-amounts").offset().top),$(this).prop("disabled",!1),!1;var n=$("#signature-line").jSignature("getData");if(n==d)return $(this).prop("disabled",!1),$("#signature-box").css("border","1px solid red"),$("body").scrollTop($("#signature-box").offset().top),!1;var a={};return a.order_number=order_number,a.signature=n,a.channel_code=partner_id,a.invest_amount=e,a.payment_method=m,a.phone=phone,a.access_token=access_token,postData({url:base_url+"/zion/common/updateSignature",data:JSON.stringify(a),contentType:"application/json; charset=utf-8",sucFn:t,failFn:i}),!1}),$(".document-item").on("click",".getPdf",function(){$("#document-preview").width("100%"),$("#document-loading").show();var e=$(this).data("id");if(!e){var t=$(this).data("url");return void a(t)}return s.document_id=e,$.ajax({type:"post",url:base_url+"/channel/doc/preview",contentType:"application/json; charset=utf-8",data:JSON.stringify(s),success:function(e){a(e.body)}}),!1}),$("#document-preview .close-document-preview").click(function(){r()}),$(".add").click(function(){var e=parseInt($(".invest-amounts").val());return""==e||isNaN(e)?$(".invest-amounts").val(c):(e+=l,$(".invest-amounts").val(e)),e<=c?$(".sub").prop("disabled",!0):$(".sub").prop("disabled",!1),!1}),$(".sub").click(function(){var e=parseInt($(".invest-amounts").val());if(e<=c)$(this).prop("disabled",!0);else{if(e-=l,e<c)return!1;$(".invest-amounts").val(e)}return!1}),$('.radio input[type="radio"]').on("change",function(){"ach"==$(this).val()?($(".ach").empty(),$(".document-info .ach").html('<a data-url="/vendor/doc/ACH.pdf" class="getPdf">ACH自动扣款协议</a>'),$(".signature .ach").html("- 我确认"+_+" ("+u+")账户里面有充足的资金并授权美信金融使用ACH从此账户扣款。")):$(".ach").empty()})});