$(function(){function e(e){var a=e.body;a&&(window.location="/auxiliary_order/share.html?product_id="+d+"&partner_id="+o+"&verify_code="+a.verify_code+"&order_number="+l+"&phone="+i)}function a(e){var a=e.body;a&&(m=a.is_ach_enabled)}function n(e){var a=e.body;if(a&&null!=a){if("FOR_INVEST"!==a.status)return window.location="/auxiliary_order/errLink.html",!1;c=a.invest_par_value||0,_=a.minimum_invest_amount||0,$(".about_product").html("<span>"+e.body.name+"</span>"+e.body.number),$(".product-rate").html("预计年化收益: "+a.return_rate+"%"),$(".product-deadline").html("投资期限: "+a.invest_term+"个月"),$(".invest-amounts").val(_),$(".invest-par-value").html(c)}}function t(e){var a=e.body;a&&null!=a&&(s=a,$("#get-name").html(a.first_name+" "+a.last_name),$("#get-phone").html(a.phone),$("#get-email").html(a.email),null!=a.base_info&&($("#get-date-of-birth").html(a.base_info.date_of_birth),$("#get-source-of-income").html(a.base_info.source_of_capital),$("#get-industry").html(a.base_info.industry),$("#get-occupation").html(a.base_info.occupation)),$("#get-passport-number").html(a.passport_number),$("#get-effective").html(a.passport_expire_date),null!=a.address_cn&&($(".get-address-line1").html(a.address_cn.region+" "+a.address_cn.city+" "+a.address_cn.district),$(".get-address-line2").html(a.address_cn.detail.replace(/\r\n|\r|\n/,", ")),$(".get-address-line3").html(a.address_cn.postal_code)),"US"==a.bank_type?($("#get-bank-aba").show(),$(".get-middle-bank").hide(),$("#get-bank-name").html(a.bank_us.bank_name),$("#get-bank-address").html(a.bank_us.bank_address.replace(/\r\n|\r|\n/,", ")),$("#get-Swift-code").html(a.bank_us.swift_code),$("#get-aba").html(a.bank_us.routing_number),$("#get-bank-user-name").html(a.first_name+" "+a.last_name),$("#get-bank-user-account").html(a.bank_us.account_number.replace(/^\d+(\d{4})$/,"****************$1")),m?$("#invest-info .payment").html('<p style="color: #000;margin-bottom: 5px;">入金方式只能选择其中一项：</p><div class="radio"><label><input type="radio" name="optionsRadios" checked value="ach">通过ACH自动从'+a.bank_us.bank_name+"（"+a.bank_us.account_number.replace(/^\d+(\d{4})$/,"$1")+'）扣款</label></div><div class="radio"><label><input type="radio" name="optionsRadios" value="wire">通过银行电汇线下打款</label></div>'):$("#invest-info .payment").html('<div class="checkbox"><label><input type="checkbox" checked value="wire" disabled>通过银行电汇线下打款</label></div>')):($("#get-bank-aba").hide(),$("#get-bank-name").html(a.bank_non_us.bank_name),$("#get-bank-address").html(a.bank_non_us.bank_address.replace(/\r\n|\r|\n/,", ")),$("#get-Swift-code").html(a.bank_non_us.swift_code),a.bank_non_us.have_middle_bank?($(".get-middle-bank").show(),$("#get-middle-bank-name").html(a.bank_non_us.middle_bank_name),$("#get-middle-bank-address").html(a.bank_non_us.middle_bank_address.replace(/\r\n|\r|\n/,", ")),$("#get-middle-bank-swift-code").html(a.bank_non_us.middle_bank_swift_code)):$(".get-middle-bank").hide(),$("#get-bank-user-name").html(a.first_name+" "+a.last_name),$("#get-bank-user-account").html(a.bank_non_us.account_number.replace(/^\d+(\d{4})$/,"****************$1")),$("#invest-info .payment").html('<div class="checkbox"><label><input type="checkbox" checked value="wire" disabled>通过银行电汇线下打款</label></div>')))}function r(e){alert(e.msg)}$('#product_head ul li[data-name="产品"]').addClass("active");var s={},i=getUrlParam("phone")||"",o=getUrlParam("partner_id")||"",d=getUrlParam("product_id")||"",l=getUrlParam("order_number")||"";""!=l&&$(".about_order").length&&$(".about_order").html("<span>订单</span>"+l),$(".prev-three").on("click",function(){window.location="/auxiliary_order/stepThree.html?product_id="+d+"&phone="+i+"&partner_id="+o+"&order_number="+l}),$(".step-four").on("click",function(){$(this).prop("disabled",!0);var a=parseInt($(".invest-amounts").val());return a<_?(alert("投资金额不能少于"+_),$(this).prop("disabled",!1),!1):a%c!=0?(alert("投资金额必须为"+_+"的整数倍"),$(this).prop("disabled",!1),!1):(s.payment_method=$("#invest-info .payment input:checked").val(),s.channel_code=o,s.product_id=d,s.phone=i,s.order_number=l,s.invest_amount=a,postData({url:base_url+"/zion/assist/operateUser",data:JSON.stringify(s),headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},contentType:"application/json; charset=utf-8",sucFn:e,failFn:r}),!1)});var c,_;""!=d&&getData({url:base_url+"/white_label/product_info",data:{product_id:d},async:!1,sucFn:n,failFn:r});var m=!1;""!=d&&getData({url:base_url+"/white_label/product/payment_list",data:{product_id:d},async:!1,sucFn:a,failFn:r}),""!=i&&getData({url:base_url+"/zion/assist/customerInfo",data:{phone:i},headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},sucFn:t,failFn:r}),$(".add").click(function(){$(".invest-amounts").val(parseInt($(".invest-amounts").val())+c)}),$(".sub").click(function(){$(".invest-amounts").val()<=_?$(".invest-amounts").val(_):$(".invest-amounts").val(parseInt($(".invest-amounts").val())-c)})});