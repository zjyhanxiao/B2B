$(function(){function e(e){var n=e.body;n&&(window.location="/auxiliary_order/share.html?product_id="+d+"&channel_code="+s+"&verify_code="+n.verify_code+"&order_number="+i+"&phone="+o)}function n(e){var n=e.body;if(n&&null!=n){if("FOR_INVEST"!==n.status)return window.location="/auxiliary_order/errLink.html",!1;l=n.invest_par_value||0,_=n.minimum_invest_amount||0,$(".about_product").html("<span>"+e.body.name+"</span>"+e.body.number),$(".product-rate").html("预计年化收益: "+n.return_rate+"%"),$(".product-deadline").html("投资期限: "+n.invest_term+"个月"),$(".invest-amounts").val(_),$(".invest-par-value").html(l)}}function a(e){var n=e.body;n&&null!=n&&(r=n,$("#get-name").html(n.first_name+" "+n.last_name),$("#get-phone").html(n.phone),$("#get-email").html(n.email),null!=n.base_info&&($("#get-date-of-birth").html(n.base_info.date_of_birth),$("#get-source-of-income").html(n.base_info.source_of_capital),$("#get-industry").html(n.base_info.industry),$("#get-occupation").html(n.base_info.occupation)),$("#get-passport-number").html(n.passport_number),$("#get-effective").html(n.passport_expire_date),null!=n.address_cn&&($(".get-address-line1").html(n.address_cn.region+" "+n.address_cn.city+" "+n.address_cn.district),$(".get-address-line2").html(n.address_cn.detail.replace(/\r\n|\r|\n/,", ")),$(".get-address-line3").html(n.address_cn.postal_code)),"US"==n.bank_type?($("#get-bank-aba").show(),$(".get-middle-bank").hide(),$("#get-bank-name").html(n.bank_us.bank_name),$("#get-bank-address").html(n.bank_us.bank_address.replace(/\r\n|\r|\n/,", ")),$("#get-Swift-code").html(n.bank_us.swift_code),$("#get-aba").html(n.bank_us.routing_number),$("#get-bank-user-name").html(n.first_name+" "+n.last_name),$("#get-bank-user-account").html(n.bank_us.account_number.replace(/^\d+(\d{4})$/,"****************$1")),$("#invest-info .checkbox label").html('<input type="checkbox">确认投资后通过ACH自动从'+n.bank_us.bank_name+"（"+n.bank_us.account_number.replace(/^\d+(\d{4})$/,"$1")+"）扣款")):($("#get-bank-aba").hide(),$("#get-bank-name").html(n.bank_non_us.bank_name),$("#get-bank-address").html(n.bank_non_us.bank_address.replace(/\r\n|\r|\n/,", ")),$("#get-Swift-code").html(n.bank_non_us.swift_code),n.bank_non_us.have_middle_bank?($(".get-middle-bank").show(),$("#get-middle-bank-name").html(n.bank_non_us.middle_bank_name),$("#get-middle-bank-address").html(n.bank_non_us.middle_bank_address.replace(/\r\n|\r|\n/,", ")),$("#get-middle-bank-swift-code").html(n.bank_non_us.middle_bank_swift_code)):$(".get-middle-bank").hide(),$("#get-bank-user-name").html(n.first_name+" "+n.last_name),$("#get-bank-user-account").html(n.bank_non_us.account_number.replace(/^\d+(\d{4})$/,"****************$1"))))}function t(e){alert(e.msg)}$('#product_head ul li[data-name="产品"]').addClass("active");var r={},o=getUrlParam("phone")||"",s=getUrlParam("channel_code")||"",d=getUrlParam("product_id")||"",i=getUrlParam("order_number")||"";""!=i&&$(".about_order").length&&$(".about_order").html("<span>订单</span>"+i),$(".prev-three").on("click",function(){window.location="/auxiliary_order/stepThree.html?product_id="+d+"&phone="+o+"&channel_code="+s+"&order_number="+i}),$(".step-four").on("click",function(){$(this).prop("disabled",!0);var n=parseInt($(".invest-amounts").val());return n<_?(alert("投资金额不能少于"+_),$(this).prop("disabled",!1),!1):n%l!=0?(alert("投资金额必须为"+_+"的整数倍"),$(this).prop("disabled",!1),!1):(r.payment_method="wire","US"==r.bank_type&&$('#invest-info .checkbox input[type="checkbox"]:checked')&&(r.payment_method="ach"),r.channel_code=s,r.product_id=d,r.phone=o,r.order_number=i,r.invest_amount=n,postData({url:base_url+"/zion/assist/operateUser",data:JSON.stringify(r),headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},contentType:"application/json; charset=utf-8",sucFn:e,failFn:t}),!1)});var l,_;""!=d&&getData({url:base_url+"/white_label/product_info",data:{product_id:d},sucFn:n,failFn:t}),""!=o&&getData({url:base_url+"/zion/assist/customerInfo",data:{phone:o},headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},sucFn:a,failFn:t}),$(".add").click(function(){$(".invest-amounts").val(parseInt($(".invest-amounts").val())+l)}),$(".sub").click(function(){$(".invest-amounts").val()<=_?$(".invest-amounts").val(_):$(".invest-amounts").val(parseInt($(".invest-amounts").val())-l)})});