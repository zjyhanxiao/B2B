$(function(){function a(a){var e=a.body;if(e&&null!=e&&($("#phone-code,#phone").prop({readOnly:!0,disabled:!0}),$("#last_name").val(e.last_name),$("#first_name").val(e.first_name),""!=e.phone&&e.phone.indexOf(" ")&&($("#phone").val(e.phone.split(" ")[1]),$("#phone-code").val(e.phone.split(" ")[0])),$("#email").val(e.email),$("#date-of-birth").val(e.base_info.date_of_birth),$("#source-of-income").val(e.base_info.source_of_capital),$("#industry").val(e.base_info.industry),$("#passport-number").val(e.passport_number),$("#effective").val(e.passport_expire_date),$(".fa-upload-pic img").attr("src",e.passport_url),""!=e.base_info.industry&&null!=e.base_info.industry&&""!=e.base_info.occupation&&null!=e.base_info.occupation)){var o=e.base_info.occupation;$.ajax({type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify({industry:e.base_info.industry}),url:base_url+"/white_label/invest/access_careers",success:function(a){var e=a.body,s="";$.each(e,function(a){s+='<option value="'+e[a].nameCn+'">'+e[a].nameCn+"</option>"}),$("#occupation").empty().append("<option value=''>请选择</option>"+s).val(o).prop("disabled",!1)}})}}function e(a){alert(a.msg)}function o(a){var e=new FormData($("form")[0]);e.append("file",$("#passport-proof")[0].files[0]),$.ajax({url:"https://prod-gl-api.meixincn.com/web/upload/private",dataType:"json",type:"post",data:e,async:!1,cache:!1,contentType:!1,processData:!1,success:function(e,o){if(1==e.code){$("#passport-false").hide();var s=e.body;a.siblings("img").attr("src",s)}1!=e.code&&alert("上传失败,请重新上传")}})}function s(a){a.value=a.value.replace(/(^|\W)(?=\d\W)/g,"$10").replace(u,f).replace(/(\W)+/g,"$1")}$('#product_head ul li[data-name="产品"]').addClass("active");var n=getUrlParam("phone")||"",t=getUrlParam("channel_code")||"",r=getUrlParam("product_id")||"",i=getUrlParam("order_number")||"",p=$(".fa-upload-pic img").attr("src");$(".step-one").on("click",function(){function a(a){var e=a.body;e&&(null!=e&&""!=e.order_number&&null!=e.order_number&&void 0!=e.order_number&&(i=e.order_number),window.location="/auxiliary_order/stepTwo.html?product_id="+r+"&phone="+n+"&channel_code="+t+"&order_number="+i)}function e(a){$(".step-one").prop("disabled",!1),alert(a.msg)}var o=$(".fa-upload-pic img").attr("src");o==p&&(o=""),$(this).prop("disabled",!0);var s=!0,d=$("#last_name").val(),l=$("#first_name").val();n=$("#phone-code").val()+" "+$("#phone").val();var c=$("#email").val(),u=$("#date-of-birth").val(),f=$("#source-of-income").val(),_=$("#industry").val(),m=$("#occupation").val(),h=$("#passport-number").val(),y=$("#effective").val(),b=/^[1][0-9][0-9][0-9]-[0-1]{0,1}[0-9]-[0-3]{0,1}[0-9]$/,v=/^[2][0-9][0-9][0-9]-[0-1]{0,1}[0-9]-[0-3]{0,1}[0-9]$/,g=h.split(""),w=g.length;if(""==d&&($("#last_name").addClass("red-shadow"),s=!1),""==l&&($("#first_name").addClass("red-shadow"),s=!1),(""==n||n.length<6)&&($("#phone").addClass("red-shadow"),s=!1),""==c&&($("#email").addClass("red-shadow"),s=!1),c.indexOf("@")!=-1&&c.indexOf(".")!=-1||($("#email").addClass("red-shadow"),s=!1),""==u&&(s=!1,$("#date-of-birth").addClass("red-shadow")),b.test(u)||(s=!1,$("#date-of-birth").addClass("red-shadow")),""==f&&(s=!1,$("#source-of-income").addClass("red-shadow")),""==_&&(s=!1,$("#industry").addClass("red-shadow")),""==m&&(s=!1,$("#occupation").addClass("red-shadow")),""==m&&(s=!1,$("#occupation").addClass("red-shadow")),""==h&&(s=!1,$("#passport-number").addClass("red-shadow")),9!=w&&(s=!1,$("#passport-number").addClass("red-shadow")),""==y&&(s=!1,$("#effective").addClass("red-shadow")),""==o&&(s=!1,$("#passport-false").show(),$("body").scrollTop($("#passport-false").eq(0).offset().top)),v.test(y)||$("#effective").addClass("red-shadow"),s){var C={};C.channel_code=t,C.product_id=r,C.order_number=i,C.phone=n,C.last_name=d,C.first_name=l,C.email=c,C.base_info={},C.base_info.date_of_birth=u,C.base_info.source_of_capital=f,C.base_info.country_of_birth="中国",C.base_info.country_of_tax_residency="中国",C.base_info.foreign_tax_number="CN N/A",C.base_info.nationality="中国",C.base_info.industry=_,C.base_info.occupation=m,C.passport_number=h,C.passport_expire_date=y,C.passport_url=o,postData({url:base_url+"/zion/assist/operateUser",data:JSON.stringify(C),headers:{mx_secret:mx_secret,mx_token:mx_token},contentType:"application/json; charset=utf-8",sucFn:a,failFn:e})}else{var x=$(".red-shadow").eq(0).offset().top;$("body").scrollTop(x),$(this).prop("disabled",!1)}return!1});var d={industry:""};$.ajax({type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(d),async:!1,url:base_url+"/white_label/invest/access_careers",success:function(a){var e=a.body,o="";$.each(e,function(a){o+='<option value="'+e[a].nameCn+'">'+e[a].nameCn+"</option>"}),$("#industry").empty().append("<option value=''>请选择</option>"+o)}}),$("#industry").on("change",function(){$("#occupation").prop("disabled",!1);var a=$("#industry").val();if(""!=a){var e={industry:a},o=JSON.stringify(e);$.ajax({type:"post",dataType:"json",contentType:"application/json",data:o,url:base_url+"/white_label/invest/access_careers",success:function(a){var e=a.body,o="";$.each(e,function(a){o+='<option value="'+e[a].nameCn+'">'+e[a].nameCn+"</option>"}),$("#occupation").empty().append("<option value=''>请选择</option>"+o)}})}else $("#occupation").empty()});var l={city:"",country:"",region:""};$.ajax({type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(l),async:!1,url:base_url+"/white_label/invest/access_district",success:function(a){var e=a.body,o="";$.each(e,function(a){o+='<option value="'+e[a].cellcode+'">'+e[a].name+" "+e[a].cellcode+"</option>"}),$("#phone-code").empty().append(o)}}),""!=n&&getData({url:base_url+"/zion/assist/customerInfo",data:{phone:n},headers:{mx_secret:mx_secret,mx_token:mx_token},sucFn:a,failFn:e}),$("#passport-proof").change(function(){$("#passport-false").hide();var a=$(this),e=$(this).val().toLowerCase(),s=new RegExp("(.*?).(jpg|jpeg|png|gif|bmp)$");s.test(e)?o(a):($(this).val(""),alert("图片格式不正确，支持图片格式(.jpg|.jpeg|.png|.gif|.bmp)"))}),$(".fa-upload-pic").find("a").click(function(){$(this).siblings("input").trigger("click")}),$("input").on("focus",function(){$(this).removeClass("red-shadow")}),$("select").on("focus",function(){$(this).removeClass("red-shadow")}),$("textarea").on("focus",function(){$(this).removeClass("red-shadow")});var c="yyyy-mm-dd",u=new RegExp(c.replace(/(\w+)\W(\w+)\W(\w+)/,"^\\s*($1)\\W*($2)?\\W*($3)?([0-9]*).*").replace(/m|d|y/g,"\\d")),f="$1/$2/$3$4".replace(/\//g,c.match(/\W/));$(".date_input_style").on("keyup",function(a){a.ctrlKey||a.metaKey||!(32==a.keyCode||a.keyCode>46)||s(a.target)})});