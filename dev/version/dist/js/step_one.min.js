$(function(){function a(a){var e=a.body;if(e&&null!=e&&($("#last_name").val(e.last_name),$("#first_name").val(e.first_name),""!=e.phone&&e.phone.indexOf(" ")&&($("#phone").val(e.phone.split(" ")[1]),$("#phone-code").val(e.phone.split(" ")[0])),$("#email").val(e.email),$("#date-of-birth").val(e.base_info.date_of_birth),$("#source-of-income").val(e.base_info.source_of_capital),$("#industry").val(e.base_info.industry),$("#passport-number").val(e.passport_number),$("#effective").val(e.passport_expire_date),$(".fa-upload-pic img").attr("src",e.passport_url),""!=e.base_info.industry&&null!=e.base_info.industry&&""!=e.base_info.occupation&&null!=e.base_info.occupation)){var s=e.base_info.occupation;$.ajax({type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify({industry:e.base_info.industry}),url:base_url+"/white_label/invest/access_careers",success:function(a){var e=a.body,o="";$.each(e,function(a){o+='<option value="'+e[a].nameCn+'">'+e[a].nameCn+"</option>"}),$("#occupation").empty().append("<option>请选择</option>"+o).val(s).prop("disabled",!1)}})}}function e(a){alert(a.msg)}function s(a){var e=new FormData($("form")[0]);e.append("file",$("#passport-proof")[0].files[0]),$.ajax({url:"https://prod-gl-api.meixincn.com/web/upload/private",dataType:"json",type:"post",data:e,async:!1,cache:!1,contentType:!1,processData:!1,success:function(e,s){if(1==e.code){$("#passport-false").hide();var o=e.body;a.siblings("img").attr("src",o)}1!=e.code&&alert("上传失败,请重新上传")}})}function o(a){a.value=a.value.replace(/(^|\W)(?=\d\W)/g,"$10").replace(c,d).replace(/(\W)+/g,"$1")}$('#product_head ul li[data-name="产品"]').addClass("active");var t=$(".fa-upload-pic img").attr("src");$(".step-one").on("click",function(){function a(a){window.location=""}function e(a){alert(a.msg)}var s=$(".fa-upload-pic img").attr("src");s==t&&(s=""),$(this).prop("disabled",!0);var o=!0,n=$("#last_name").val(),i=$("#first_name").val(),r=$("#phone-code").val()+" "+$("#phone").val(),p=$("#email").val(),c=$("#date-of-birth").val(),d=$("#source-of-income").val(),l=$("#industry").val(),u=$("#occupation").val(),f=$("#passport-number").val(),_=$("#effective").val(),h=/^[1][0-9][0-9][0-9]-[0-1]{0,1}[0-9]-[0-3]{0,1}[0-9]$/,m=/^[2][0-9][0-9][0-9]-[0-1]{0,1}[0-9]-[0-3]{0,1}[0-9]$/,y=f.split(""),v=y.length;if(""==n&&($("#last_name").addClass("red-shadow"),o=!1),""==i&&($("#first_name").addClass("red-shadow"),o=!1),(""==r||r.length<6)&&($("#phone").addClass("red-shadow"),o=!1),""==p&&($("#email").addClass("red-shadow"),o=!1),p.indexOf("@")!=-1&&p.indexOf(".")!=-1||($("#email").addClass("red-shadow"),o=!1),""==c&&(o=!1,$("#date-of-birth").addClass("red-shadow")),h.test(c)||(o=!1,$("#date-of-birth").addClass("red-shadow")),""==d&&(o=!1,$("#source-of-income").addClass("red-shadow")),""!=l&&"请选择"!=l||(o=!1,$("#industry").addClass("red-shadow")),""!=u&&"请选择"!=u||(o=!1,$("#occupation").addClass("red-shadow")),""==f&&(o=!1,$("#passport-number").addClass("red-shadow")),9!=v&&(o=!1,$("#passport-number").addClass("red-shadow")),""==_&&(o=!1,$("#effective").addClass("red-shadow")),""==s&&(o=!1,$("#passport-false").show(),$("body").scrollTop($("#passport-false").eq(0).offset().top)),m.test(_)||$("#effective").addClass("red-shadow"),o){var b={};b.last_name=n,b.first_name=i,b.phone=r,b.email=p,b.base_info={},b.base_info.date_of_birth=c,b.base_info.source_of_capital=d,b.base_info.country_of_birth="中国",b.base_info.country_of_tax_residency="中国",b.base_info.foreign_tax_number="CN N/A",b.base_info.nationality="中国",b.base_info.industry=l,b.base_info.occupation=u,b.passport_number=f,b.passport_expire_date=_,b.passport_url=s,postData({url:base_url+"/zion/assist/operateUser",data:JSON.stringify(b),headers:{mx_secret:mx_secret,mx_token:mx_token},contentType:"application/json; charset=utf-8",sucFn:a,failFn:e})}else{var g=$(".red-shadow").eq(0).offset().top;$("body").scrollTop(g),$(this).prop("disabled",!1)}});var n={industry:""};$.ajax({type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(n),async:!1,url:base_url+"/white_label/invest/access_careers",success:function(a){var e=a.body,s="";$.each(e,function(a){s+='<option value="'+e[a].nameCn+'">'+e[a].nameCn+"</option>"}),$("#industry").empty().append("<option>请选择</option>"+s)}}),$("#industry").on("change",function(){$("#occupation").prop("disabled",!1);var a=$("#industry").val();if("请选择"!=a){var e={industry:a},s=JSON.stringify(e);$.ajax({type:"post",dataType:"json",contentType:"application/json",data:s,url:base_url+"/white_label/invest/access_careers",success:function(a){var e=a.body,s="";$.each(e,function(a){s+='<option value="'+e[a].nameCn+'">'+e[a].nameCn+"</option>"}),$("#occupation").empty().append("<option>请选择</option>"+s)}})}else $("#occupation").empty()});var i={city:"",country:"",region:""};$.ajax({type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(i),async:!1,url:base_url+"/white_label/invest/access_district",success:function(a){var e=a.body,s="";$.each(e,function(a){s+='<option value="'+e[a].cellcode+'">'+e[a].name+" "+e[a].cellcode+"</option>"}),$("#phone-code").empty().append(s)}});var r=getUrlParam("phone")||"";""!=r&&getData({url:base_url+"/zion/assist/customerInfo",data:{phone:r},headers:{mx_secret:mx_secret,mx_token:mx_token},sucFn:a,failFn:e}),$("#passport-proof").change(function(){$("#passport-false").hide();var a=$(this),e=$(this).val().toLowerCase(),o=new RegExp("(.*?).(jpg|jpeg|png|gif|bmp)$");o.test(e)?s(a):($(this).val(""),alert("图片格式不正确，支持图片格式(.jpg|.jpeg|.png|.gif|.bmp)"))}),$(".fa-upload-pic").find("a").click(function(){$(this).siblings("input").trigger("click")}),$("input").on("focus",function(){$(this).removeClass("red-shadow")}),$("select").on("focus",function(){$(this).removeClass("red-shadow")}),$("textarea").on("focus",function(){$(this).removeClass("red-shadow")});var p="yyyy-mm-dd",c=new RegExp(p.replace(/(\w+)\W(\w+)\W(\w+)/,"^\\s*($1)\\W*($2)?\\W*($3)?([0-9]*).*").replace(/m|d|y/g,"\\d")),d="$1/$2/$3$4".replace(/\//g,p.match(/\W/));$(".date_input_style").on("keyup",function(a){a.ctrlKey||a.metaKey||!(32==a.keyCode||a.keyCode>46)||o(a.target)})});