$(function(){function e(e){var a=e.body;if(a&&null!=a&&($("#last_name").val(a.last_name),$("#first_name").val(a.first_name),""!=a.phone&&a.phone.indexOf(" ")&&$("#phone").val(a.phone.split(" ")[1]),$("#email").val(a.email),$("#date-of-birth").val(a.base_info.date_of_birth),$("#source-of-income").val(a.base_info.source_of_capital),$("#industry").val(a.base_info.industry),$("#passport-number").val(a.passport_number),$("#effective").val(a.passport_expire_date),$("#fileMapping img").attr("src",a.passport_url),""!=a.base_info.industry&&null!=a.base_info.industry&&""!=a.base_info.occupation&&null!=a.base_info.occupation)){var o=a.base_info.occupation;n({industry:a.base_info.industry}),$("#occupation").val(o)}}function a(e){alert(e.msg)}function o(e){e.value=e.value.replace(/(^|\W)(?=\d\W)/g,"$10").replace(u,f).replace(/(\W)+/g,"$1")}function n(e){postData({data:JSON.stringify(e),url:base_url+"/white_label/invest/access_careers",contentType:"application/json",async:!1,sucFn:function(e){var a=e.body,o="";$.each(a,function(e){o+='<option value="'+a[e].nameCn+'">'+a[e].nameCn+"</option>"}),$("#occupation").empty().append("<option value=''>请选择</option>"+o).prop("disabled",!1)},failFn:function(e){alert(e.message)}})}$('#product_head ul li[data-name="产品"]').addClass("active");var s={},t=getUrlParam("phone")||"",r=getUrlParam("partner_id")||"",i=getUrlParam("product_id")||"",d=getUrlParam("order_number")||"";""!=t&&($("#phone-code,#phone").prop("disabled",!0),t.indexOf(" ")?($("#phone").val(t.split(" ")[1]),$("#phone-code").val(t.split(" ")[0])):$("#phone").val(t));var l=$("#fileMapping img").attr("src");$(".step-one").on("click",function(){function e(e){var a=e.body;a&&(s=a,null!=a&&""!=a.order_number&&null!=a.order_number&&void 0!=a.order_number&&(d=a.order_number),window.location="/auxiliary_order/stepTwo.html?product_id="+i+"&phone="+t+"&partner_id="+r+"&order_number="+d)}function a(e){$(".step-one").prop("disabled",!1),alert(e.msg)}var o=$("#fileMapping img").attr("src");o==l&&(o=""),$(this).prop("disabled",!0);var n=!0,p=$("#last_name").val(),c=$("#first_name").val();t=$("#phone-code").val()+" "+$("#phone").val();var u=$("#email").val(),f=$("#date-of-birth").val(),_=$("#source-of-income").val(),m=$("#industry").val(),h=$("#occupation").val(),v=$("#passport-number").val(),b=$("#effective").val(),y=/^[1][0-9][0-9][0-9]-[0-1]{0,1}[0-9]-[0-3]{0,1}[0-9]$/,g=/^[2][0-9][0-9][0-9]-[0-1]{0,1}[0-9]-[0-3]{0,1}[0-9]$/,w=v.split(""),C=w.length;if(""==p&&($("#last_name").addClass("red-shadow"),n=!1),""==c&&($("#first_name").addClass("red-shadow"),n=!1),(""==t||t.length<6)&&($("#phone").addClass("red-shadow"),n=!1),""==u&&($("#email").addClass("red-shadow"),n=!1),u.indexOf("@")!=-1&&u.indexOf(".")!=-1||($("#email").addClass("red-shadow"),n=!1),""==f&&(n=!1,$("#date-of-birth").addClass("red-shadow")),y.test(f)||(n=!1,$("#date-of-birth").addClass("red-shadow")),""==_&&(n=!1,$("#source-of-income").addClass("red-shadow")),""==m&&(n=!1,$("#industry").addClass("red-shadow")),""==h&&(n=!1,$("#occupation").addClass("red-shadow")),""==h&&(n=!1,$("#occupation").addClass("red-shadow")),""==v&&(n=!1,$("#passport-number").addClass("red-shadow")),9!=C&&(n=!1,$("#passport-number").addClass("red-shadow")),""==b&&(n=!1,$("#effective").addClass("red-shadow")),""==o&&(n=!1,$("#passport-false").show(),$("body").scrollTop($("#passport-false").eq(0).offset().top)),g.test(b)||$("#effective").addClass("red-shadow"),n)s.channel_code=r,s.product_id=i,s.order_number=d,s.phone=$("#phone-code").val()+" "+$("#phone").val(),s.last_name=p,s.first_name=c,s.email=u,s.investor_type=1,s.base_info={},s.base_info.date_of_birth=f,s.base_info.source_of_capital=_,s.base_info.country_of_birth="中国",s.base_info.country_of_tax_residency="中国",s.base_info.foreign_tax_number="CN N/A",s.base_info.nationality="中国",s.base_info.industry=m,s.base_info.occupation=h,s.passport_number=v,s.passport_expire_date=b,s.passport_url=o,postData({url:base_url+"/zion/assist/operateUser",data:JSON.stringify(s),headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},contentType:"application/json; charset=utf-8",sucFn:e,failFn:a});else{var x=$(".red-shadow").eq(0).offset().top;$("body").scrollTop(x),$(this).prop("disabled",!1)}return!1});var p={industry:""};$.ajax({type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(p),async:!1,url:base_url+"/white_label/invest/access_careers",success:function(e){var a=e.body,o="";$.each(a,function(e){o+='<option value="'+a[e].nameCn+'">'+a[e].nameCn+"</option>"}),$("#industry").empty().append("<option value=''>请选择</option>"+o)}}),$("#industry").on("change",function(){$("#occupation").prop("disabled",!1);var e=$("#industry").val();if(""!=e){var a={industry:e};n(a)}else $("#occupation").empty()}),""!=t&&getData({url:base_url+"/zion/assist/customerOrderInfo",data:{phone:t,order_number:d},headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},sucFn:e,failFn:a}),$("input").on("focus",function(){$(this).removeClass("red-shadow")}),$("select").on("focus",function(){$(this).removeClass("red-shadow")}),$("textarea").on("focus",function(){$(this).removeClass("red-shadow")});var c="yyyy-mm-dd",u=new RegExp(c.replace(/(\w+)\W(\w+)\W(\w+)/,"^\\s*($1)\\W*($2)?\\W*($3)?([0-9]*).*").replace(/m|d|y/g,"\\d")),f="$1/$2/$3$4".replace(/\//g,c.match(/\W/));$(".date_input_style").on("keyup",function(e){e.ctrlKey||e.metaKey||!(32==e.keyCode||e.keyCode>46)||o(e.target)}),$("#fileMapping").click(function(){$(".filePicker input").trigger("click")}),uploader_file("#fileMapping")});