$(function(){function e(e){$("#country").empty().append("<option value=''>请选择</option>"+e),$("#country").find("option:first").prop("selected","selected")}function d(e){function d(e){$("#city").empty().append("<option value=''>请选择</option>"+e).prop("disabled",!1).val(r.address_cn.city)}function a(e){$("#county").empty().append("<option value=''>请选择</option>"+e).prop("disabled",!1).val(r.address_cn.district)}var r=e.body;if(r&&null!=r&&(o=r,null!=r.id_card_expire_date&&""!=r.id_card_expire_date&&$("#address-effective").val(r.id_card_expire_date),null!=r.id_card_url&&""!=r.id_card_url&&$("#fileMapping img").attr("src",r.id_card_url),"CN"==r.address_type&&null!=r.address_cn)){if(""!=r.address_cn.region&&null!=r.address_cn.region&&""!=r.address_cn.city&&null!=r.address_cn.city&&""!=r.address_cn.district&&null!=r.address_cn.district){$("#country").val(r.address_cn.region);var i={city:"",country:"中国",region:r.address_cn.region};t(i,d);var n={city:r.address_cn.city,country:"中国",region:r.address_cn.region};t(n,a)}""!=r.address_cn.detail&&null!=r.address_cn.detail&&$("#address-detail").val(r.address_cn.detail),r.address_cn.postal_code&&$("#post-code").val(r.address_cn.postal_code)}}function a(e){alert(e.msg)}function t(e,d){$.ajax({type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(e),async:!1,url:base_url+"/white_label/invest/access_district",success:function(e){var a=e.body,t="";a&&a.length>0&&($.each(a,function(e){t+='<option value="'+a[e].name+'">'+a[e].name+"</option>"}),d(t))}})}function r(e){e.value=e.value.replace(/(^|\W)(?=\d\W)/g,"$10").replace(_,f).replace(/(\W)+/g,"$1")}$('#product_head ul li[data-name="产品"]').addClass("active");var o={},i=getUrlParam("phone")||"",n=getUrlParam("partner_id")||"",s=getUrlParam("product_id")||"",c=getUrlParam("order_number")||"",l=$("#fileMapping img").attr("src");$(".prev-one").on("click",function(){window.location="/auxiliary_order/stepOne.html?product_id="+s+"&phone="+i+"&partner_id="+n+"&order_number="+c}),$(".step-two").on("click",function(){function e(e){var d=e.body;d&&(window.location="/auxiliary_order/stepThree.html?product_id="+s+"&phone="+i+"&partner_id="+n+"&order_number="+c)}function d(e){$(".step-two").prop("disabled",!1),alert(e.msg)}var a=$("#fileMapping img").attr("src");a==l&&(a=""),$(this).prop("disabled",!0);var t=!0,r=$("#address-effective").val(),p=$("#country").val(),u=$("#city").val(),_=$("#county").val(),f=$("#address-detail").val(),y=$("#post-code").val(),m=/^[1-2][0-9][0-9][0-9]-[0-1]{0,1}[0-9]-[0-3]{0,1}[0-9]$/;if(m.test(r)||($("#address-effective").addClass("red-shadow"),t=!1),""==p&&($("#country").addClass("red-shadow"),t=!1),""==u&&($("#city").addClass("red-shadow"),t=!1),""==_&&($("#county").addClass("red-shadow"),t=!1),""==f&&($("#address-detail").addClass("red-shadow"),t=!1),""==y&&($("#post-code").addClass("red-shadow"),t=!1),""==r&&($("#address-effective").addClass("red-shadow"),t=!1),""==a&&($("#address-false").show(),t=!1),t)o.channel_code=n,o.product_id=s,o.order_number=c,o.phone=i,o.id_card_url=a,o.id_card_expire_date=r,o.address_type="CN",o.address_cn={},o.address_cn.country="中国",o.address_cn.region=p,o.address_cn.city=u,o.address_cn.district=_,o.address_cn.detail=f,o.address_cn.postal_code=y,postData({url:base_url+"/zion/assist/operateUser",data:JSON.stringify(o),headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},contentType:"application/json; charset=utf-8",sucFn:e,failFn:d});else{$(this).prop("disabled",!1);var h=$(".red-shadow").eq(0).offset().top;$("body").scrollTop(h)}return!1});var p={city:"",country:"中国",region:""};t(p,e),$("#country").on("change",function(){function e(e){$("#city").empty().append("<option value=''>请选择</option>"+e).prop("disabled",!1),$("#city").find("option:first").prop("selected","selected")}var d=$(this).val();if(""!=d){var a={city:"",country:"中国",region:d};t(a,e)}}),$("#city").on("change",function(){function e(e){$("#county").empty().append("<option value=''>请选择</option>"+e).prop("disabled",!1),$("#county").find("option:first").prop("selected","selected")}var d=$(this).val();if(""!=d){var a={city:d,country:"中国",region:$("#country").val()};t(a,e)}}),""!=i&&getData({url:base_url+"/zion/assist/customerOrderInfo",data:{phone:i,order_number:c},headers:{mx_secret:$.cookie("mx_secret"),mx_token:$.cookie("mx_token")},sucFn:d,failFn:a}),$("input").on("focus",function(){$(this).removeClass("red-shadow")}),$("select").on("focus",function(){$(this).removeClass("red-shadow")}),$("textarea").on("focus",function(){$(this).removeClass("red-shadow")});var u="yyyy-mm-dd",_=new RegExp(u.replace(/(\w+)\W(\w+)\W(\w+)/,"^\\s*($1)\\W*($2)?\\W*($3)?([0-9]*).*").replace(/m|d|y/g,"\\d")),f="$1/$2/$3$4".replace(/\//g,u.match(/\W/));$(".date_input_style").on("keyup",function(e){e.ctrlKey||e.metaKey||!(32==e.keyCode||e.keyCode>46)||r(e.target)}),$("#fileMapping").click(function(){$(".filePicker input").trigger("click")}),uploader_file("#fileMapping"),$(".uploader-demo").find("img").load(function(){var e=$(".uploader-demo").find("img").width(),d=$(".uploader-demo").find("img").height(),a=$(".file-item").width(),t=$(".file-item").height();e/d<a/t?$(".uploader-demo").find("img").css({width:"auto",height:"100%"}):$(".uploader-demo").find("img").css({width:"100%",height:"auto","margin-top":Math.floor((t-a*d/e)/2)+"px"})})});